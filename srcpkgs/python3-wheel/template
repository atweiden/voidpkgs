maintainer="nox"
pkgname="python3-wheel"
version=0.37.1
revision=2
short_desc="Built-package format for Python (Python3)"
depends="python3-setuptools"
checkdepends+=" $depends"
checkdepends+=" python3-devel"
checkdepends+=" python3-pytest"
hostmakedepends="python3-setuptools"
homepage="https://github.com/pypa/wheel"
license="MIT"
distfiles="$PYPI_SITE/w/wheel/wheel-$version.tar.gz"
checksum="e9a504e793efbca1b8e0e9cb979a249cf4a0a7b5b8c9e8b65a5e39d49529c1c4"
wrksrc="wheel-$version"
build_style="python3-module"
conflicts="python-wheel>=0"

do_check() {
  local _pypath

  vsed \
    -i \
    -e '/addopts/d' \
    setup.cfg

  # must export PYTHONPATH so subprocesses see the variable
  _pypath="$PYTHONPATH"
  export PYTHONPATH="$PWD/src:$PYTHONPATH"
  python3 -m pytest --ignore="tests/test_macosx_libfile.py"

  if [[ -n "$_pypath" ]]; then
    export PYTHONPATH="$_pypath"
  else
    unset PYTHONPATH
  fi
}

post_install() {
  vlicense LICENSE.txt LICENSE
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
