maintainer="nox"
pkgname="android-tools"
version=33.0.3
revision=1
short_desc="Android platform tools (adb and fastboot)"
archs+=" aarch64*"
archs+=" armv*"
archs+=" i686*"
archs+=" ppc64le*"
archs+=" x86_64*"
depends="python3"
makedepends+=" brotli-devel"
makedepends+=" gtest-devel"
makedepends+=" liblz4-devel"
makedepends+=" libusb-devel"
makedepends+=" libzstd-devel"
makedepends+=" pcre2-devel"
makedepends+=" protobuf-devel"
makedepends+=" zlib-devel"
hostmakedepends+=" go"
hostmakedepends+=" perl"
hostmakedepends+=" pkg-config"
hostmakedepends+=" protobuf"
homepage="http://developer.android.com/tools/help/adb.html"
license="Apache-2.0, ISC, GPL-2.0-only, MIT"
distfiles="https://github.com/nmeum/android-tools/releases/download/$version/$pkgname-$version.tar.xz"
checksum="8ce174dab781d5debd29ed0f96572231f777bee19b8ef3c167e33d3ea7670bc5"
build_style="cmake"

if [[ -n "$XBPS_TARGET_NO_ATOMIC8" ]]; then
  makedepends+=" libatomic-devel"
  configure_args="-DCMAKE_CXX_STANDARD_LIBRARIES=-latomic"
fi

post_install() {
  # zsh's built in works, while this one doesn't
  rm -f "$DESTDIR/usr/share/zsh/site-functions/_adb"
  vlicense vendor/boringssl/LICENSE boringssl.LICENSE
  vlicense vendor/boringssl/third_party/fiat/LICENSE fiat.LICENSE
  vsv adb
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
