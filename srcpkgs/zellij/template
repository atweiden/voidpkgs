maintainer="nox"
pkgname="zellij"
version=0.38.2
revision=1
short_desc="Terminal workspace with batteries included"
# dependency crate wasmer-vm only supports x86_64, arm64, x86
# https://docs.wasmer.io/ecosystem/wasmer/wasmer-features#compiler-support-by-chipset
archs+=" aarch64*"
archs+=" i686*"
archs+=" x86_64*"
checkdepends+=" libssh2-devel"
checkdepends+=" pkg-config"
hostmakedepends="mandown"
homepage="https://zellij.dev"
license="MIT"
changelog="https://github.com/zellij-org/zellij/raw/main/CHANGELOG.md"
distfiles="https://github.com/zellij-org/zellij/archive/v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="18e8ae9fa2ad995af5f6c64b3c0713143d260cdc6c1a978831313bfaf305ad5e"
build_style="cargo"
make_check_pre="env LIBSSH2_SYS_USE_PKG_CONFIG=1"
# shell completion generation requires qemu (see: upstream)
nocross="yes"

post_install() {
  vdoc README.md
  vinstall assets/zellij.desktop 644 usr/share/applications
  vlicense LICENSE.md

  # build shell completions without cross-platform support (see: upstream)
  for shell in bash \
               fish \
               zsh; do
    "$DESTDIR/usr/bin/zellij" setup --generate-completion "$shell" > "zellij.$shell"
    vcompletion "zellij.$shell" "$shell"
  done

  mandown docs/MANPAGE.md > zellij.1
  vman zellij.1
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
