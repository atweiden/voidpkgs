maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="python-pytest"
version=3.7.1
revision=2
short_desc="Simple powerful testing with Python2"
noarch="yes"
depends+=" python-atomicwrites"
depends+=" python-attrs"
depends+=" python-funcsigs"
depends+=" python-more-itertools"
depends+=" python-pathlib2"
depends+=" python-pluggy"
depends+=" python-py"
depends+=" python-setuptools"
checkdepends+=" python3-atomicwrites"
checkdepends+=" python3-atomicwrites"
checkdepends+=" python3-hypothesis"
checkdepends+=" python3-more-itertools"
checkdepends+=" python3-pluggy"
checkdepends+=" python3-py"
hostmakedepends+=" python-setuptools"
hostmakedepends+=" python3-setuptools"
homepage="https://docs.pytest.org/en/latest/"
license="MIT"
changelog="https://raw.githubusercontent.com/pytest-dev/pytest/master/CHANGELOG.rst"
distfiles="$PYPI_SITE/p/pytest/pytest-$version.tar.gz"
checksum="86a8dbf407e437351cef4dba46736e9c5a6e3c3ac71b2e942209748e76ff2086"
wrksrc="${pkgname/python-//}-$version"
build_style="python-module"
pycompile_module+=" _pytest"
pycompile_module+=" pytest.py"
alternatives+=" pytest:py.test:/usr/bin/py.test2"
alternatives+=" pytest:pytest:/usr/bin/pytest2"

pre_build() {
  sed \
    -i \
    -e '/setup_requires=/d' \
    -e "s|use_scm_version=.*|version=\"$version\",|" \
    setup.py
}

do_check() {
  python3 setup.py test
}

post_install() {
  vlicense LICENSE
}

python3-pytest_package() {
  unset alternatives
  unset depends
  unset pycompile_module
  noarch="yes"
  pycompile_module+=" _pytest"
  pycompile_module+=" pytest.py"
  alternatives+=" pytest:py.test:/usr/bin/py.test3"
  alternatives+=" pytest:pytest:/usr/bin/pytest3"
  short_desc="${short_desc/Python2/Python3}"
  depends+=" python3-atomicwrites"
  depends+=" python3-attrs"
  depends+=" python3-more-itertools"
  depends+=" python3-pluggy"
  depends+=" python3-py"
  depends+=" python3-setuptools"
  pkg_install() {
    vmove "usr/bin/*3"
    vmove "usr/lib/python3*"
    vlicense LICENSE
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
