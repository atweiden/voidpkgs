maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="libcap"
version=2.26
revision=1
short_desc="POSIX.1e capabilities suite"
makedepends="attr-devel"
homepage="http://sites.google.com/site/fullycapable/"
license="GPL-2.0-only"
distfiles="$KERNEL_SITE/libs/security/linux-privs/libcap2/$pkgname-$version.tar.xz"
checksum="b630b7c484271b3ba867680d6a14b10a86cfa67247a14631b14c06731d5a458b"
bootstrap="yes"

if [[ -n "$CHROOT_READY" ]]; then
  hostmakedepends="perl"
  if [[ -z "$CROSS_BUILD" ]]; then
    hostmakedepends+=" gperf"
  fi
fi

do_configure() {
  sed \
    -i \
    -e 's/CFLAGS :=/CFLAGS +=/g' \
    Make.Rules
  sed \
    -i \
    -e 's/LDFLAGS :=/LDFLAGS +=/g' \
    Make.Rules
  sed \
    -i \
    -e '/BUILD_CFLAGS/s/$(CFLAGS)//' \
    Make.Rules
}

do_build() {
  make CC="$CC" BUILD_CC="cc"
}

do_install() {
  make \
    DESTDIR="$DESTDIR" \
    LIBDIR="/usr/lib" \
    MANDIR="/usr/share/man" \
    PKGCONFIGDIR="/usr/lib/pkgconfig" \
    RAISE_SETFCAP="no" \
    SBINDIR="/usr/bin" \
    install
}

libcap-devel_package() {
  depends="libcap>=${version}_$revision"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/libcap.a
    vmove usr/lib/libcap.so
    vmove usr/share/man/man3
    vmove usr/lib/pkgconfig
  }
}

libcap-progs_package() {
  short_desc+=" - utilities"
  pkg_install() {
    vmove usr/bin
    vmove usr/share
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
