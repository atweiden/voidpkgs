maintainer="nox"
pkgname="rsync"
version=3.2.4
revision=1
short_desc="Remote fast incremental file transfer tool"
makedepends+=" acl-devel"
makedepends+=" liblz4-devel"
makedepends+=" libzstd-devel"
makedepends+=" openssl-devel"
makedepends+=" popt-devel"
makedepends+=" xxHash-devel"
makedepends+=" zlib-devel"
hostmakedepends="perl"
homepage="https://rsync.samba.org/"
license="GPL-3.0-only"
changelog="https://download.samba.org/pub/rsync/NEWS"
distfiles="https://www.samba.org/ftp/rsync/src/$pkgname-$version.tar.gz"
checksum="6f761838d08052b0b6579cf7f6737d93e47f01f4da04c5d24d3447b7f2a5fad1"
conf_files="/etc/rsyncd.conf"
build_style="gnu-configure"
if [[ -n "$CROSS_BUILD" ]]; then
  configure_args=" --disable-simd"
fi

# force enable IPv6 on musl - upstream bug
# https://bugzilla.samba.org/show_bug.cgi?id=10715
CFLAGS="-DINET6"

pre_check() {
  # chgrp tests fail inside chroot
  rm -f testsuite/chgrp.test
}

post_install() {
  vconf "$FILESDIR/rsyncd.conf"
  vsv rsyncd
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
