maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="mutt"
version=1.12.0
revision=1
short_desc="Mutt Mail Client"
depends="mime-types"
makedepends+=" gdbm-devel"
makedepends+=" gpgme-devel"
makedepends+=" libassuan-devel"
makedepends+=" libgpg-error-devel"
makedepends+=" libidn2-devel"
makedepends+=" libressl-devel"
makedepends+=" libsasl-devel"
makedepends+=" ncurses-devel"
hostmakedepends+=" libidn2-devel"
hostmakedepends+=" perl"
hostmakedepends+=" pkg-config"
homepage="http://www.mutt.org"
license="GPL-2.0-or-later"
changelog="http://mutt.org/relnotes/1.12"
distfiles="http://ftp.mutt.org/pub/mutt/$pkgname-$version.tar.gz"
checksum="ca12448784ed7b6c86d498921e18bc7b152d45494a452df56a7a0c8aaf13f98f"
conf_files="/etc/mutt/Muttrc"
build_style="gnu-configure"
configure_args+=" --enable-gpgme"
configure_args+=" --enable-hcache"
configure_args+=" --enable-imap"
configure_args+=" --enable-pop"
configure_args+=" --enable-sidebar"
configure_args+=" --enable-smtp"
configure_args+=" --sysconfdir=/etc/mutt"
configure_args+=" --with-gdbm=$XBPS_CROSS_BASE/usr"
configure_args+=" --with-gpgme-prefix=$XBPS_CROSS_BASE/usr"
configure_args+=" --with-idn2"
configure_args+=" --with-regex"
configure_args+=" --with-sasl"
configure_args+=" --with-ssl"
configure_args+=" mutt_cv_regex_broken=no"
provides="mutt-0_1"
alternatives+=" mutt:flea.1:/usr/share/man/man1/flea-mutt.1"
alternatives+=" mutt:flea:/usr/bin/flea-mutt"
alternatives+=" mutt:flea:/usr/bin/flea-mutt"
alternatives+=" mutt:mbox.5:/usr/share/man/man5/mbox-mutt.5"
alternatives+=" mutt:mmdf.5:/usr/share/man/man5/mmdf-mutt.5"
alternatives+=" mutt:mutt.1:/usr/share/man/man1/mutt-mutt.1"
alternatives+=" mutt:mutt:/usr/bin/mutt-mutt"
alternatives+=" mutt:mutt_pgpring:/usr/bin/mutt_pgpring-$pkgname"
alternatives+=" mutt:muttbug.1:/usr/share/man/man1/muttbug-mutt.1"
alternatives+=" mutt:muttbug:/usr/bin/muttbug-mutt"
alternatives+=" mutt:muttrc.5:/usr/share/man/man5/muttrc-mutt.5"
alternatives+=" mutt:pgpewrap.1:/usr/share/man/man1/pgpewrap-mutt.1"
alternatives+=" mutt:pgpewrap:/usr/bin/pgpewrap-mutt"
alternatives+=" mutt:pgpring.1:/usr/share/man/man1/mutt_pgpring-$pkgname.1"
alternatives+=" mutt:pgpring.1:/usr/share/man/man1/pgpring-mutt.1"
alternatives+=" mutt:smime_keys.1:/usr/share/man/man1/smime_keys-mutt.1"
alternatives+=" mutt:smime_keys:/usr/bin/smime_keys-mutt"

pre_build() {
  make \
    CC="$BUILD_CC" \
    CFLAGS="$BUILD_CFLAGS -fPIC" \
    CPPFLAGS= \
    mutt_md5
  make \
    CC="$BUILD_CC" \
    CFLAGS="$BUILD_CFLAGS -fPIC" \
    CPPFLAGS= \
    -C doc
}

post_install() {
  # provided by mime-types
  rm "$DESTDIR/etc/$pkgname"/mime.*
  ln -s /etc/mime.types "$DESTDIR/etc/$pkgname/mime.types"
  # move dist to examples dir
  vsconf contrib/gpg.rc Muttrc.gpg.dist
  mv "$DESTDIR/etc/$pkgname/Muttrc.dist" "$DESTDIR/usr/share/examples/$pkgname"
  # allow alternatives to work
  for manpage in "$DESTDIR/usr/share/man"/man[15]/*; do
    mv "$manpage" "${manpage%.*}-$pkgname.${manpage##*.}"
  done
  for binary in "$DESTDIR/usr/bin"/*; do
    mv "$binary" "$binary-$pkgname"
  done
}

# REMARKS:
#
# Conf file is in a `--sysconfdir=/etc/$pkgname/Muttrc` and then
# `alternatives` to `/etc/Muttrc`. In addition, a dependency on
# `mime-types` is broken by having `/etc/dir/` because mutt probably
# expects the mime information in the same dir as sysconfdir. Thus a
# symlink is created to deal with this.
#
# `/etc/Muttrc` is not currently in `alternatives` to prevent
# inadvertently overwriting configuration.

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
