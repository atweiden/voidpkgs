maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="mutt"
version=1.12.1
revision=3
short_desc="Mutt Mail Client"
depends+=" cyrus-sasl-modules"
depends+=" mime-types"
makedepends+=" gdbm-devel"
makedepends+=" gpgme-devel"
makedepends+=" libassuan-devel"
makedepends+=" libgpg-error-devel"
makedepends+=" libidn2-devel"
makedepends+=" libressl-devel"
makedepends+=" libsasl-devel"
makedepends+=" ncurses-devel"
hostmakedepends+=" libidn2-devel"
hostmakedepends+=" perl"
hostmakedepends+=" pkg-config"
homepage="http://www.mutt.org"
license="GPL-2.0-or-later"
changelog="http://mutt.org/relnotes/1.12"
distfiles="http://ftp.mutt.org/pub/mutt/$pkgname-$version.tar.gz"
checksum="01c565406ec4ffa85db90b45ece2260b25fac3646cc063bbc20a242c6ed4210c"
conf_files="/etc/mutt/Muttrc"
build_style="gnu-configure"
configure_args+=" --enable-gpgme"
configure_args+=" --enable-hcache"
configure_args+=" --enable-imap"
configure_args+=" --enable-pop"
configure_args+=" --enable-sidebar"
configure_args+=" --enable-smtp"
configure_args+=" --sysconfdir=/etc/mutt"
configure_args+=" --with-gdbm=$XBPS_CROSS_BASE/usr"
configure_args+=" --with-gpgme-prefix=$XBPS_CROSS_BASE/usr"
configure_args+=" --with-idn2"
configure_args+=" --with-regex"
configure_args+=" --with-sasl"
configure_args+=" --with-ssl"
configure_args+=" mutt_cv_regex_broken=no"

pre_build() {
  make \
    CC="$BUILD_CC" \
    CFLAGS="$BUILD_CFLAGS -fPIC" \
    CPPFLAGS= \
    mutt_md5
  make \
    CC="$BUILD_CC" \
    CFLAGS="$BUILD_CFLAGS -fPIC" \
    CPPFLAGS= \
    -C doc
}

post_install() {
  # provided by mime-types
  rm "$DESTDIR/etc/$pkgname"/mime.*
  ln -s /etc/mime.types "$DESTDIR/etc/$pkgname/mime.types"
  # move dist to examples dir
  vsconf contrib/gpg.rc Muttrc.gpg.dist
  mv "$DESTDIR/etc/$pkgname/Muttrc.dist" "$DESTDIR/usr/share/examples/$pkgname"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
