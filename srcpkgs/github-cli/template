maintainer="nox"
pkgname="github-cli"
version=2.16.1
revision=1
short_desc="GitHub CLI tool"
homepage="https://cli.github.com"
license="MIT"
changelog="https://github.com/cli/cli/releases"
distfiles="https://github.com/cli/cli/archive/v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="ed42d919d22b33c60d7c4243ac37cc1127e342817e563038aeba2e2a3f93ed81"
wrksrc="cli-$version"
build_style="go"
go_import_path="github.com/cli/cli/v2/cmd/gh"
go_ldflags+=" -buildid="
go_ldflags+=" -X github.com/cli/cli/v2/internal/build.Version=v$version"
# shell completion generation requires qemu (see: upstream)
nocross="yes"

export GOFLAGS="-trimpath"

pre_build() {
  local _date

  if [[ -n "$SOURCE_DATE_EPOCH" ]]; then
    _date="$(date --utc --date "@$SOURCE_DATE_EPOCH" "+%Y-%m-%d")"
    go_ldflags+=" -X github.com/cli/cli/v2/internal/build.Date=$_date"
  fi
}

post_build() {
  local gh

  CGO_ENABLED=0 \
  GOARCH="" \
    go run script/build.go manpages

  gh="$(find $GOPATH/bin -name gh)"

  for shell in bash \
               fish \
               zsh; do
    "$gh" completion -s "$shell" > "github-cli.$shell"
  done
}

post_install() {
  vlicense LICENSE
  vcopy share/man usr/share
  for shell in bash \
               fish \
               zsh; do
    vcompletion "github-cli.$shell" "$shell" gh
  done
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
