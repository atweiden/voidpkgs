maintainer="nox"
pkgname="nvme-cli"
version=2.1.1
revision=1
short_desc="NVMe management command line interface"
makedepends+=" json-c-devel"
makedepends+=" libnvme-devel"
makedepends+=" libuuid-devel"
makedepends+=" zlib-devel"
hostmakedepends="pkg-config"
homepage="http://nvmexpress.org"
license="GPL-2.0-only"
distfiles="https://github.com/linux-nvme/nvme-cli/archive/v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="cc8bd36b9aa71243e2bace238aa5505244fef3fef5418b0c61f75d1988458272"
conf_files="/etc/nvme/*.conf"
build_style="meson"
configure_args+=" -Ddocs=man"
configure_args+=" -Dudevrulesdir=lib/udev/rules.d"

if [[ "$XBPS_TARGET_LIBC" == "glibc" ]]; then
  makedepends+=" libhugetlbfs-devel"
else
  CFLAGS="-D_GNU_SOURCE"
fi

post_install() {
  # remove files that are systemd-only
  rm -rf "$DESTDIR/usr/lib/systemd"
  # calls systemctl
  rm -rf "$DESTDIR/usr/lib/udev/rules.d/70-nvmf-autoconnect.rules"
  # needs 70-nvmf-autoconnect.rules
  rm -rf "$DESTDIR/usr/lib/dracut/dracut.conf.d/70-nvmf-autoconnect.conf"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
