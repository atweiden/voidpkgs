maintainer="nox"
pkgname="libwebp"
version=1.2.4
revision=2
short_desc="WebP image format"
makedepends+=" giflib-devel"
makedepends+=" libpng-devel"
makedepends+=" tiff-devel"
hostmakedepends="pkg-config"
homepage="https://developers.google.com/speed/webp/"
license="BSD-3-Clause"
distfiles="http://downloads.webmproject.org/releases/webp/$pkgname-$version.tar.gz"
checksum="7bf5a8a28cc69bcfa8cb214f2c3095703c6b73ac5fba4d5480c205331d9494df"
build_style="gnu-configure"
# avoid libfreeglut gui dependency
configure_args+=" --disable-gl"
# inherit remaining configure_args from upstream
configure_args+=" --enable-libwebpdecoder"
configure_args+=" --enable-libwebpdemux"
configure_args+=" --enable-libwebpmux"

case "$XBPS_TARGET_MACHINE" in
  armv6*)
    configure_args+=" --disable-neon"
    ;;
  armv7*)
    CFLAGS="-mfpu=neon"
    ;;
esac

post_install() {
  vlicense COPYING LICENSE
}

libwebp-tools_package() {
  short_desc+=" - tools"
  pkg_install() {
    vmove usr/bin
    vmove usr/share/man
  }
}

libwebp-devel_package() {
  unset depends
  depends+=" $makedepends"
  depends+=" $sourcepkg>=${version}_$revision"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/pkgconfig
    vmove "usr/lib/*.so"
    vmove "usr/lib/*.a"
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
