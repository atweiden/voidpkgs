maintainer="nox"
pkgname="python3-cryptography"
version=3.4.8
revision=2
short_desc="Python3 library that provides cryptographic recipes and primitives"
depends="python3-cffi"
makedepends+=" openssl-devel"
makedepends+=" python3-devel"
checkdepends+=" $depends"
checkdepends+=" python3-cryptography_vectors"
checkdepends+=" python3-hypothesis"
checkdepends+=" python3-iso8601"
checkdepends+=" python3-pretend"
checkdepends+=" python3-pytest-subtests"
checkdepends+=" python3-pytz"
hostmakedepends+=" python3-cffi"
hostmakedepends+=" python3-setuptools-rust"
homepage="https://github.com/pyca/cryptography"
license="BSD-3-Clause, Apache-2.0"
changelog="https://github.com/pyca/cryptography/raw/master/CHANGELOG.rst"
distfiles="$PYPI_SITE/c/cryptography/cryptography-$version.tar.gz"
checksum="94cc5ed4ceaefcbe5bf38c8fba6a21fc1d365bb8fb826ea1688e3370b2e24a1c"
wrksrc="${pkgname#python3-}-$version"
build_style="python3-module"

# the rust extension is a no-op designed to test build systems and,
# for the moment, does not work properly with python 3.10 on cross
#
# hopefully upstream tooling will make accommodating python 3.10 trivial
# by the time the rust extension actually does something
#
# see, e.g., commit 58bc3876d33bfa5e37a21b5a4b27f016af387a76 to see how
# the rust extension was built with python 3.9
export CRYPTOGRAPHY_DONT_BUILD_RUST=1

post_install() {
  vlicense LICENSE
  vlicense LICENSE.BSD

  chmod 755 "$DESTDIR/$py3_sitelib/cryptography/hazmat/bindings"/*.so
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
