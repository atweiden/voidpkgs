maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="pinentry"
version=1.1.0
revision=5
short_desc="PIN or passphrase entry dialogs for GnuPG"
makedepends+=" libassuan-devel"
makedepends+=" libgpg-error-devel"
makedepends+=" ncurses-devel"
hostmakedepends="pkgconf"
homepage="https://www.gnupg.org/related_software/pinentry/"
license="GPL-2.0-or-later"
distfiles="https://www.gnupg.org/ftp/gcrypt/pinentry/$pkgname-$version.tar.bz2"
checksum="68076686fa724a290ea49cdf0d1c0c1500907d1b759a3bcbfbec0293e8f56570"
build_style="gnu-configure"
configure_args+=" --disable-libsecret"
configure_args+=" --disable-pinentry-fltk"
configure_args+=" --disable-pinentry-gnome3"
configure_args+=" --disable-pinentry-gtk2"
configure_args+=" --disable-pinentry-qt"
configure_args+=" --disable-pinentry-qt5"
configure_args+=" --disable-pinentry-tqt"
configure_args+=" --disable-rpath"
configure_args+=" --enable-fallback-curses"
configure_args+=" --enable-pinentry-curses"
configure_args+=" --enable-pinentry-emacs"
configure_args+=" --enable-pinentry-tty"
configure_args+=" --with-gnu-ld"
configure_args+=" --without-libcap"
if [[ -n "$CROSS_BUILD" ]]; then
  configure_args+=" --host=$XBPS_CROSS_TRIPLET"
fi
alternatives="pinentry:pinentry:/usr/bin/pinentry-curses"

pre_build() {
  sed \
    -i \
    -e 's,ncursesw/curses.h,curses.h,' \
    pinentry/pinentry-curses.c
}

post_install() {
  rm "$DESTDIR/usr/bin/pinentry"
}

pinentry-tty_package() {
  depends="$sourcepkg>=${version}_$revision"
  short_desc+=" - tty version"
  alternatives="pinentry:pinentry:/usr/bin/pinentry-tty"
  pkg_install() {
    vmove usr/bin/pinentry-tty
  }
}

pinentry-emacs_package() {
  depends="$sourcepkg>=${version}_$revision"
  short_desc+=" - Emacs interface"
  alternatives="pinentry:pinentry:/usr/bin/pinentry-emacs"
  pkg_install() {
    vmove usr/bin/pinentry-emacs
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
