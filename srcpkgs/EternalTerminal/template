maintainer="nox"
pkgname="EternalTerminal"
version=6.0.13
revision=7
short_desc="Re-Connectable secure remote shell"
makedepends+=" gflags-devel"
makedepends+=" libsodium-devel"
makedepends+=" protobuf-devel"
if [[ "$XBPS_TARGET_LIBC" == "musl" ]]; then
  makedepends+=" libexecinfo-devel"
fi
hostmakedepends="protobuf"
homepage="https://eternalterminal.dev/"
license="Apache-2.0"
distfiles="https://github.com/MisterTea/EternalTerminal/archive/et-v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="728c3a444d666897c710e33fe473d8d289263a59574451b13aa53ec3c6ac88b3"
build_style="cmake"
system_accounts="_eternal"

LDFLAGS="-lgflags"

post_patch() {
  if [[ "$XBPS_TARGET_LIBC" == "musl" ]]; then
    # use external libexecinfo
    vsed \
      -i \
      -e '/execinfo/!s/CORE_LIBRARIES util resolv/& execinfo/' \
      CMakeLists.txt
  fi
}

post_install() {
  vsv etserver
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
