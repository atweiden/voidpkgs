maintainer="nox"
pkgname="arch-wiki-lite"
# keep synced with arch-wiki-docs
version=2023.08.21
revision=1
short_desc="Arch Wiki without HTML"
depends+=" bash"
depends+=" coreutils"
depends+=" dialog"
depends+=" grep"
depends+=" gzip"
depends+=" less"
depends+=" sed"
depends+=" util-linux"
hostmakedepends+=" arch-wiki-docs"
hostmakedepends+=" python3"
homepage="http://www.kmkeen.com/arch-wiki-lite/"
license="GFDL-1.3-or-later,GPL-3.0-only"
distfiles="http://www.kmkeen.com/arch-wiki-lite/$pkgname.tar.gz"
checksum="b381e3f5589d652346621a4be33988efd924fd702b1c204dcab452a92bb00ca4"

pre_build() {
  local arch_wiki_docs
  local arch_wiki_docs_html
  local arch_wiki_docs_text

  arch_wiki_docs='\/usr\/share\/doc\/arch-wiki-docs'
  arch_wiki_docs_html="$(printf "%s\/html" "$arch_wiki_docs")"
  arch_wiki_docs_text="$(printf "%s\/text" "$arch_wiki_docs")"

  # in wiki-search executable, wiki_path is text
  sed \
    -i \
    -e 's/^\(wiki_path\).*/\1='''\"$arch_wiki_docs_text\"'''/' \
    -e 's/^\(html_path\).*/\1='''\"$arch_wiki_docs_html\"'''/' \
    wiki-search

  # in wiki_lite.py executable, wiki_path is html
  sed \
    -i \
    -e 's/^\(wiki_path\).*/\1 = '''\'$arch_wiki_docs_html\\/\''''/' \
    wiki_lite.py
}

do_build() {
  LC_ALL="en_US.UTF-8" python3 wiki_lite.py
}

do_install() {
  vbin wiki-search
  vmkdir usr/share/doc/arch-wiki-docs/text
  vcopy "wiki/*" usr/share/doc/arch-wiki-docs/text
  vinstall wiki-search.dialog.rc 644 etc/dialog.d wiki-search.dialog.rc
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
