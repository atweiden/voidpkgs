maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="glib"
version=2.58.0
revision=5
makedepends+=" dbus-devel"
makedepends+=" elfutils-devel"
makedepends+=" libffi-devel"
makedepends+=" libmount-devel"
makedepends+=" pcre-devel"
makedepends+=" zlib-devel"
checkdepends+=" desktop-file-utils"
checkdepends+=" shared-mime-info"
checkdepends+=" tzdata"
hostmakedepends+=" docbook-xsl"
hostmakedepends+=" libxslt"
hostmakedepends+=" m4"
hostmakedepends+=" pkg-config"
hostmakedepends+=" python3"
short_desc="The GNU library of C routines"
homepage="https://wiki.gnome.org/Projects/GLib"
license="LGPL-2.1-or-later"
changelog="https://gitlab.gnome.org/GNOME/glib/raw/master/NEWS"
distfiles="$GNOME_SITE/glib/${version%.*}/glib-$version.tar.xz"
checksum="c0f4ce0730b4f95c47b711613b5406a887c2ee13ea6d25930d72a4fa7fdb77f6"
build_style="meson"
configure_args+=" --default-library=both"
configure_args+=" -Dfam=false"
configure_args+=" -Dgtk_doc=false"
configure_args+=" -Dman=true"
configure_args+=" -Dselinux=false"

if [[ -n "$CROSS_BUILD" ]]; then
  hostmakedepends+=" glib-devel"
fi

libglib-devel_package() {
  depends+=" $makedepends"
  depends+=" glib>=${version}_$revision"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/glib-2.0
    vmove usr/lib/pkgconfig
    vmove "usr/lib/*.a"
    vmove "usr/lib/*.so"
  }
}

glib-devel_package() {
  depends+=" libglib-devel>=${version}_$revision"
  depends+=" python3"
  short_desc+=" - development files"
  pycompile_version="$py3_ver"
  pycompile_dirs+=" usr/share/glib-2.0/codegen"
  pycompile_dirs+=" usr/share/glib-2.0/gdb"
  pkg_install() {
    vmove usr/bin/gdbus-codegen
    vmove usr/bin/glib-compile-resources
    vmove usr/bin/glib-genmarshal
    vmove usr/bin/glib-gettextize
    vmove usr/bin/glib-mkenums
    vmove usr/bin/gtester
    vmove usr/bin/gtester-report
    vmove usr/share/man/man1/gdbus-codegen.1
    vmove usr/share/man/man1/glib-compile-resources.1
    vmove usr/share/man/man1/glib-genmarshal.1
    vmove usr/share/man/man1/glib-gettextize.1
    vmove usr/share/man/man1/glib-mkenums.1
    vmove usr/share/man/man1/gtester-report.1
    vmove usr/share/man/man1/gtester.1
    for f in aclocal \
             gdb \
             glib-2.0; do
      vmove "usr/share/$f"
    done
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
