maintainer="nox"
pkgname="iproute2"
version=6.6.0
revision=2
short_desc="IP Routing Utilities"
makedepends+=" db-devel"
makedepends+=" elfutils-devel"
makedepends+=" iptables-devel"
makedepends+=" libfl-devel"
makedepends+=" libmnl-devel"
hostmakedepends+=" flex"
hostmakedepends+=" perl"
hostmakedepends+=" pkg-config"
homepage="https://wiki.linuxfoundation.org/networking/iproute2"
license="GPL-2.0-only"
distfiles="$KERNEL_SITE/utils/net/iproute2/$pkgname-$version.tar.xz"
checksum="8738c804afd09f0bf756937f0c3de23117832a98d8cbbf50386cf5005cd613ce"
conf_files+=" /etc/iproute2/bpf_pinning"
conf_files+=" /etc/iproute2/ematch_map"
conf_files+=" /etc/iproute2/group"
conf_files+=" /etc/iproute2/nl_protos"
conf_files+=" /etc/iproute2/rt_dsfield"
conf_files+=" /etc/iproute2/rt_protos"
conf_files+=" /etc/iproute2/rt_realms"
conf_files+=" /etc/iproute2/rt_scopes"
conf_files+=" /etc/iproute2/rt_tables"
build_style="configure"
# requires unshare, which is not provided by chroot-util-linux
make_check="no"
make_install_args="SBINDIR=/usr/bin"

post_install() {
  vmkdir etc
  vcopy etc/iproute2 etc
  rm -r "$DESTDIR/usr/share/man/man3"
}

iproute2-tc-ipt_package() {
  short_desc+=" - tc(8) IPtables support"
  pkg_install() {
    # m_ipt.so is symlinked to m_xt.so
    vmove usr/lib/tc/m_ipt.so
    vmove usr/lib/tc/m_xt.so
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
