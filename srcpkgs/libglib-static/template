maintainer="nox"
pkgname="libglib-static"
version=2.58.3
revision=3
depends+=" dbus-devel"
depends+=" elfutils-devel"
depends+=" libffi-devel"
depends+=" libmount-devel"
depends+=" pcre-devel"
depends+=" zlib-devel"
makedepends="$depends"
hostmakedepends+=" automake"
hostmakedepends+=" docbook-xsl"
hostmakedepends+=" libtool"
hostmakedepends+=" libxslt"
hostmakedepends+=" pkg-config"
hostmakedepends+=" python3"
short_desc="GNU library of C routines"
homepage="https://wiki.gnome.org/Projects/GLib"
license="LGPL-2.1-or-later"
changelog="https://gitlab.gnome.org/GNOME/glib/raw/master/NEWS"
distfiles="$GNOME_SITE/glib/${version%.*}/glib-$version.tar.xz"
checksum="8f43c31767e88a25da72b52a40f3301fefc49a665b56dc10ee7cc9565cbe7481"
wrksrc="glib-$version"
build_style="gnu-configure"
configure_args+=" --disable-fam"
configure_args+=" --disable-shared"
configure_args+=" --enable-libelf"
configure_args+=" --enable-static"
configure_args+=" --with-pcre=system"

if [[ -n "$CROSS_BUILD" ]]; then
  hostmakedepends+=" glib-devel"
  case "$XBPS_TARGET_MACHINE" in
    mips*|ppc|ppc-musl)
      # it seems mips/ppc autoconf cache is not read?
      configure_args+=" glib_cv_rtldglobal_broken=no"
      configure_args+=" glib_cv_stack_grows=no"
      configure_args+=" glib_cv_uscore=no"
      ;;
  esac
fi

pre_configure() {
  NOCONFIGURE=1 ./autogen.sh
}

post_install() {
  rm -r "$DESTDIR/usr/bin"
  rm -r "$DESTDIR/usr/share"
}

# REMARKS:
#
# this is only used for qemu-user-static until meson figures out building
# static glib 2.60.0 via meson

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
