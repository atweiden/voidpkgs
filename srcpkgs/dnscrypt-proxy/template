maintainer="nox"
pkgname="dnscrypt-proxy"
version=2.1.4
revision=4
short_desc="DNS proxy that encrypts queries"
homepage="https://github.com/DNSCrypt/dnscrypt-proxy"
license="ISC"
changelog="https://github.com/DNSCrypt/dnscrypt-proxy/raw/master/ChangeLog"
distfiles="https://github.com/DNSCrypt/dnscrypt-proxy/archive/$version.tar.gz>$pkgname-$version.tar.gz"
checksum="05f0a3e8c8f489caf95919e2a75a1ec4598edd3428d2b9dd357caba6adb2607d"
conf_files="/etc/dnscrypt-proxy.toml"
system_accounts="dnscrypt_proxy"
make_dirs="/var/log/dnscrypt-proxy 0750 dnscrypt_proxy dnscrypt_proxy"
build_style="go"
go_import_path="github.com/dnscrypt/dnscrypt-proxy"
go_package="$go_import_path/dnscrypt-proxy"
go_build_tags+=" netgo"
go_build_tags+=" osusergo"
go_ldflags="-buildid="
if [[ "$XBPS_TARGET_LIBC" == "musl" ]]; then
  go_ldflags+=" -extldflags=-static"
  go_ldflags+=" -linkmode=external"
fi

pre_build() {
  export GOFLAGS="-trimpath"
  export GOTOOLCHAIN="go1.20.7"
}

post_install() {
  vconf dnscrypt-proxy/example-dnscrypt-proxy.toml dnscrypt-proxy.toml
  vlicense LICENSE
  vsv dnscrypt-proxy
  for example in dnscrypt-proxy/example*txt; do
    vdoc "$example"
  done
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
