maintainer="nox"
pkgname="dnsmasq"
version=2.80
revision=7
short_desc="Lightweight, easy to configure DNS forwarder and DHCP server"
makedepends+=" dbus-devel"
makedepends+=" libcap-devel"
makedepends+=" libidn2-devel"
makedepends+=" $(vopt_if dnssec nettle-devel)"
hostmakedepends="pkg-config"
homepage="http://www.thekelleys.org.uk/dnsmasq/doc.html"
license="GPL-2.0-or-later"
distfiles="http://www.thekelleys.org.uk/dnsmasq/$pkgname-$version.tar.gz"
checksum="9e4a58f816ce0033ce383c549b7d4058ad9b823968d352d2b76614f83ea39adc"
conf_files="/etc/dnsmasq.conf"
system_accounts="dnsmasq"
dnsmasq_homedir="/var/chroot"
build_options="dnssec"
build_options_default="dnssec"
desc_option_dnssec="Enable DNSSEC support via nettle"

do_build() {
  echo '#define HAVE_DBUS' >> src/config.h
  echo '#define HAVE_LIBIDN2' >> src/config.h
  if [[ -n "$build_option_dnssec" ]]; then
    echo '#define HAVE_DNSSEC' >> src/config.h
  fi
  make \
    CC="$CC" \
    CFLAGS="$CFLAGS" \
    LDFLAGS="$LDFLAGS" \
    "$makejobs"
}

do_install() {
  make \
    BINDIR="/usr/bin" \
    DESTDIR="$DESTDIR" \
    PREFIX="/usr" \
    install
  vsv dnsmasq
  vconf dnsmasq.conf.example dnsmasq.conf
  vinstall "$FILESDIR/dbus.conf" 644 etc/dbus-1/system.d
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
