maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="gawk"
version=4.2.1
revision=1
short_desc="The GNU awk utility"
makedepends="readline-devel"
homepage="https://directory.fsf.org/wiki/Gawk"
license="GPL-3"
distfiles="$GNU_SITE/$pkgname/$pkgname-$version.tar.xz"
checksum="d1119785e746d46a8209d28b2de404a57f983aa48670f4e225531d3bdc175551"
build_style="gnu-configure"
configure_args="--with-readline"
lib32disabled="yes"
provides="awk-0_1"
alternatives+=" awk:awk:/usr/bin/gawk"
alternatives+=" awk:awk.1:/usr/share/man/man1/gawk.1"

pre_configure() {
  # create symlinks for bins and manpages
  sed -i -e "s|\$(LN)|\$(LN_S)|g" Makefile.in doc/Makefile.in
}

pre_check() {
  sed -i 's/done | more/done/g' test/Makefile
  case "$XBPS_TARGET_MACHINE" in
    *-musl)
      sed -i '/testext/d' test/Makefile
      sed -i '/clos1way6/d' test/Makefile
      ;;
  esac
}

post_install() {
  rm "$DESTDIR/usr/bin/awk"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
