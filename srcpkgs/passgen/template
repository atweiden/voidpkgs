maintainer="nox"
pkgname="passgen"
version=1.0.0
revision=1
_gitrev="33696fe23cd14df76637b497fa66ea25c8f3111c"
# the revision passgen uses as a submodule for the specific version
_utf8proc_gitrev="462093b3924c7491defc67fda4bc7a27baf9b088"
short_desc="Regex-based password generator"
makedepends="jansson-devel"
hostmakedepends+=" pkg-config"
hostmakedepends+=" ruby"
homepage="https://github.com/xfbs/passgen"
license="MIT"
distfiles+=" https://gitlab.com/xfbs/passgen/-/archive/master/passgen-$_gitrev.tar.gz>$pkgname-$version.tar.gz"
distfiles+=" https://github.com/JuliaStrings/utf8proc/archive/$_utf8proc_gitrev.tar.gz"
checksum+=" 18db2c4b0e5f0bde7a19cf345af83ce0c3ef5caa74833ee77af176400c5dc846"
checksum+=" 095fd8f48e95a6e894e8a0ac419662f3e0c7a4d43b4cce05550d4e902754ee54"
skip_extraction+=" $_utf8proc_gitrev.tar.gz"
wrksrc="$pkgname-master-$_gitrev"
build_style="cmake"
configure_args+=" -DBUILD_BENCH=NO"
configure_args+=" -DBUILD_GIT_INFO=OFF"
configure_args+=" -DLIBPASSGEN_STATIC=OFF"
shlib_provides="libpassgen.so"

case "$XBPS_TARGET_MACHINE" in
  *-musl)
    makedepends+=" libexecinfo-devel"
    configure_args+=" -DUSE_LIBEXECINFO=ON"
    ;;
esac

post_extract() {
  bsdtar xzf "$XBPS_SRCDISTDIR/$pkgname-$version/$_utf8proc_gitrev.tar.gz" \
    --strip-components=1 -C "$wrksrc/extern/utf8proc"
}

post_install() {
  vlicense LICENSE
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
