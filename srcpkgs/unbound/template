maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="unbound"
version=1.9.6
revision=1
short_desc="Validating, recursive, and caching DNS resolver"
depends="dnssec-anchors"
makedepends+=" expat-devel"
makedepends+=" libevent-devel"
makedepends+=" libsodium-devel"
homepage="https://unbound.net/"
license="BSD-3-Clause"
distfiles="https://unbound.net/downloads/$pkgname-$version.tar.gz"
checksum="1d98fc6ea99197a20b4a0e540e87022cf523085786e0fc26de6ebb2720f5aaf0"
conf_files="/etc/unbound/unbound.conf"
build_style="gnu-configure"
configure_args+=" --enable-dnscrypt"
configure_args+=" --enable-event-api"
configure_args+=" --sbindir=/usr/bin"
configure_args+=" --with-conf-file=/etc/unbound/unbound.conf"
configure_args+=" --with-libevent"
configure_args+=" --with-libevent=$XBPS_CROSS_BASE/usr"
configure_args+=" --with-libexpat=$XBPS_CROSS_BASE/usr"
configure_args+=" --with-pidfile=/run/unbound.pid"
configure_args+=" --with-rootkey-file=/etc/dns/root.key"
configure_args+=" --with-ssl=$XBPS_CROSS_BASE/usr"
configure_args+=" --with-username=_unbound"
system_accounts="_unbound"

post_install() {
  vsconf doc/example.conf unbound.conf
  vinstall "$FILESDIR/unbound.conf" 644 etc/unbound
  vsv unbound
  vlicense LICENSE
}

unbound-devel_package() {
  unset depends
  depends+=" libevent-devel"
  depends+=" libressl-devel"
  depends+=" unbound>=$version"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove "usr/lib/*.a"
    vmove "usr/lib/*.so"
    vmove usr/lib/pkgconfig
    vmove usr/share/man/man3
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
