maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="strace"
version=4.26
revision=1
short_desc="A System Call Tracer"
makedepends="libunwind-devel"
homepage="https://strace.io/"
license="LGPL-2.1-or-later"
distfiles="https://github.com/strace/strace/releases/download/v$version/$pkgname-$version.tar.xz"
checksum="7c4d2ffeef4f7d1cdc71062ca78d1130eb52f947c2fca82f59f6a1183bfa1e1c"
build_style="gnu-configure"
configure_args="--with-libunwind"

case "$XBPS_TARGET_MACHINE" in
  aarch64-musl)
    configure_args=
    makedepends=
    ;;
esac

case "$XBPS_TARGET_MACHINE" in
  aarch64*)
    configure_args+=" --enable-mpers=no"
    ;;
esac

pre_configure() {
  sed \
    -i \
    -e 's/include <linux\/socket.h>/include <sys\/socket.h>/g' \
    -e 's/include <sgidefs.h>/include <asm\/sgidefs.h>/g' \
    configure
  case "$XBPS_TARGET_MACHINE" in
    *-musl)
      export CFLAGS+=" -Dsigcontext_struct=sigcontext"
      ;;
  esac
}

post_install() {
  vlicense COPYING
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
