maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="rakudo"
version=2019.11
revision=1
short_desc="Production-ready, stable implementation of the Perl 6 language"
depends="nqp>=${version}_1"
makedepends+=" libatomic_ops-devel"
makedepends+=" libffi-devel"
# XXX: temporarily disabled to fix MoarVM-2019.11 build
#makedepends+=" libtommath-devel"
makedepends+=" libuv-devel"
makedepends+=" libzstd-devel"
makedepends+=" nqp"
hostmakedepends="perl"
tags="perl6"
homepage="https://rakudo.org"
license="Artistic-2.0"
changelog="https://github.com/rakudo/rakudo/raw/master/docs/ChangeLog"
distfiles="https://github.com/rakudo/rakudo/releases/download/$version/$pkgname-$version.tar.gz"
checksum="36e19160d7a8b5dd723e5602d851ccef9e4cf0970e1c67589bf88935ceb65531"
build_style="configure"
configure_script="perl Configure.pl"
configure_args+=" --backends=moar"
configure_args+=" --perl6-home=/usr/lib"
configure_args+=" --prefix=/usr"
if [[ -n "$CROSS_BUILD" ]]; then
  configure_args+=" --sdkroot=$XBPS_CROSS_BASE"
  configure_args+=" --sysroot=$XBPS_CROSS_BASE"
fi
make_check_target="test"
make_install_args+=" RAKUDO_LOG_PRECOMP=1"
make_install_args+=" RAKUDO_RERESOLVE_DEPENDENCIES=0"
nocross="yes"
make_dirs+=" /usr/lib/perl6/bin 0755 root root"
make_dirs+=" /usr/lib/perl6/core/bin 0755 root root"
make_dirs+=" /usr/lib/perl6/core/resources 0755 root root"
make_dirs+=" /usr/lib/perl6/lib 0755 root root"
make_dirs+=" /usr/lib/perl6/resources 0755 root root"
make_dirs+=" /usr/lib/perl6/site/bin 0755 root root"
make_dirs+=" /usr/lib/perl6/site/dist 0755 root root"
make_dirs+=" /usr/lib/perl6/site/precomp 0755 root root"
make_dirs+=" /usr/lib/perl6/site/resources 0755 root root"
make_dirs+=" /usr/lib/perl6/site/short 0755 root root"
make_dirs+=" /usr/lib/perl6/site/sources 0755 root root"
make_dirs+=" /usr/lib/perl6/vendor/bin 0755 root root"
make_dirs+=" /usr/lib/perl6/vendor/dist 0755 root root"
make_dirs+=" /usr/lib/perl6/vendor/precomp 0755 root root"
make_dirs+=" /usr/lib/perl6/vendor/resources 0755 root root"
make_dirs+=" /usr/lib/perl6/vendor/short 0755 root root"
make_dirs+=" /usr/lib/perl6/vendor/sources 0755 root root"
provides="perl6-${version}_$revision"

post_install() {
  vbin tools/install-dist.p6 perl6-install-dist
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
