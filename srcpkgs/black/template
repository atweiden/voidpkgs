maintainer="nox"
pkgname="black"
version=22.6.0
revision=1
short_desc="Uncompromising Python code formatter"
depends+=" python3-click"
depends+=" python3-mypy_extensions"
depends+=" python3-pathspec"
depends+=" python3-platformdirs"
depends+=" python3-tomli"
checkdepends+=" $depends"
checkdepends+=" python3-aiohttp"
checkdepends+=" python3-colorama"
# XXX: python3-ipython requires gui deps
#checkdepends+=" python3-ipython"
checkdepends+=" python3-pytest-xdist"
checkdepends+=" python3-tokenize-rt"
checkdepends+=" python3-uvloop"
hostmakedepends+=" python3-setuptools"
hostmakedepends+=" python3-setuptools_scm"
homepage="https://github.com/psf/black"
license="MIT"
changelog="https://github.com/psf/black/raw/main/CHANGES.md"
distfiles="$PYPI_SITE/b/black/black-$version.tar.gz"
checksum="6c6d39e28aed379aec40da1c65434c77d75e65bb59a1e1c283de545fb4e7c6c9"
build_style="python3-module"

do_check() {
  local pyver

  PYTHONPATH="$(cd build/lib* && pwd)" python3 -m pytest --run-optional jupyter -m jupyter

  pyver=$(python3 -c 'import sys; print(f"{sys.version_info.major}.{sys.version_info.minor}")')

  mv "$XBPS_MASTERDIR/usr/lib/python$pyver/site-packages/IPython" \
    "$XBPS_MASTERDIR/tmp/IPython.bak"

  PYTHONPATH="$(cd build/lib* && pwd)" python3 -m pytest --run-optional no_jupyter

  mv "$XBPS_MASTERDIR/tmp/IPython.bak" \
    "$XBPS_MASTERDIR/usr/lib/python$pyver/site-packages/IPython"

  PYTHONPATH="$(cd build/lib* && pwd)" python3 -m black --check src tests setup.py
}

post_install() {
  vlicense LICENSE
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
