maintainer="nox"
pkgname="bash"
_bash_distver=5.0
_bash_patchlevel=011
version=$_bash_distver.$_bash_patchlevel
revision=1
short_desc="GNU Bourne Again Shell"
makedepends="ncurses-devel"
hostmakedepends="bison"
homepage="https://www.gnu.org/software/bash/bash.html"
license="GPL-3.0-or-later"
distfiles="$GNU_SITE/bash/$pkgname-$_bash_distver.tar.gz"
checksum="b4a80f2ac66170b2913efbfb9f2594f1f76c7b1afd11f799e22035d63077fb4d"
wrksrc="$pkgname-$_bash_distver"
build_style="gnu-configure"
configure_args+=" --with-curses"
configure_args+=" --without-bash-malloc"
configure_args+=" --without-installed-readline"
make_build_args="TERMCAP_LIB=$XBPS_CROSS_BASE/usr/lib/libncursesw.a"
register_shell+=" /bin/bash"
register_shell+=" /usr/bin/bash"
make_dirs="/etc/bash/bashrc.d 755 root root"
conflicts="chroot-bash>=0"
alternatives+=" sh:sh:/usr/bin/bash"
alternatives+=" sh:sh.1:/usr/share/man/man1/bash.1"

CFLAGS="-DSYS_BASHRC='\"/etc/bash/bashrc\"'"

pre_configure() {
  local ver=$(echo "$_bash_distver" | sed "s|\.||g")
  cd "$wrksrc"
  for p in $(seq -w 001 $_bash_patchlevel); do
    patch -sNp0 -i "$FILESDIR/bash$ver-$p"
    msg_normal " Applying patch bash$ver-$p.\n"
  done
}

do_check() {
  make tests
}

post_install() {
  rm -rf "$DESTDIR/usr/share/doc"
  ln -s bash "$DESTDIR/usr/bin/rbash"
  vmkdir /etc/bash
  vinstall "$FILESDIR/bashrc" 644 etc/bash
  vinstall "$FILESDIR/bash.sh" 644 etc/profile.d
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
