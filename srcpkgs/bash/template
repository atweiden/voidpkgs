maintainer="nox"
pkgname="bash"
version=5.0.017
revision=1
_bash_distver=${version%.*}
_bash_patchlevel=${version##*.}
_patchprefix="bash${_bash_distver/./}"
short_desc="GNU Bourne Again Shell"
makedepends="ncurses-devel"
hostmakedepends="bison"
homepage="https://www.gnu.org/software/bash/bash.html"
license="GPL-3.0-or-later"
distfiles="$GNU_SITE/bash/$pkgname-$_bash_distver.tar.gz"
checksum="b4a80f2ac66170b2913efbfb9f2594f1f76c7b1afd11f799e22035d63077fb4d"
_url="$GNU_SITE/bash/bash-$_bash_distver-patches"
for _p in $(seq -w 001 $_bash_patchlevel); do
  distfiles+=" $_url/$_patchprefix-$_p"
  skip_extraction+=" $_patchprefix-$_p"
done
checksum+=" b4a80f2ac66170b2913efbfb9f2594f1f76c7b1afd11f799e22035d63077fb4d"
checksum+=" f2fe9e1f0faddf14ab9bfa88d450a75e5d028fedafad23b88716bd657c737289"
checksum+=" 87e87d3542e598799adb3e7e01c8165bc743e136a400ed0de015845f7ff68707"
checksum+=" 4eebcdc37b13793a232c5f2f498a5fcbf7da0ecb3da2059391c096db620ec85b"
checksum+=" 14447ad832add8ecfafdce5384badd933697b559c4688d6b9e3d36ff36c62f08"
checksum+=" 5bf54dd9bd2c211d2bfb34a49e2c741f2ed5e338767e9ce9f4d41254bf9f8276"
checksum+=" d68529a6ff201b6ff5915318ab12fc16b8a0ebb77fda3308303fcc1e13398420"
checksum+=" 17b41e7ee3673d8887dd25992417a398677533ab8827938aa41fad70df19af9b"
checksum+=" eec64588622a82a5029b2776e218a75a3640bef4953f09d6ee1f4199670ad7e3"
checksum+=" ed3ca21767303fc3de93934aa524c2e920787c506b601cc40a4897d4b094d903"
checksum+=" d6fbc325f0b5dc54ddbe8ee43020bced8bd589ddffea59d128db14b2e52a8a11"
checksum+=" 2c4de332b91eaf797abbbd6c79709690b5cbd48b12e8dfe748096dbd7bf474ea"
checksum+=" 2943ee19688018296f2a04dbfe30b7138b889700efa8ff1c0524af271e0ee233"
checksum+=" f5d7178d8da30799e01b83a0802018d913d6aa972dd2ddad3b927f3f3eb7099a"
checksum+=" 5d6eee6514ee6e22a87bba8d22be0a8621a0ae119246f1c5a9a35db1f72af589"
checksum+=" a517df2dda93b26d5cbf00effefea93e3a4ccd6652f152f4109170544ebfa05e"
checksum+=" ffd1d7a54a99fa7f5b1825e4f7e95d8c8876bc2ca151f150e751d429c650b06d"
checksum+=" 4cf3b9fafb8a66d411dd5fc9120032533a4012df1dc6ee024c7833373e2ddc31"
wrksrc="$pkgname-$_bash_distver"
build_style="gnu-configure"
configure_args+=" --with-curses"
configure_args+=" --without-bash-malloc"
configure_args+=" --without-installed-readline"
make_build_args="TERMCAP_LIB=$XBPS_CROSS_BASE/usr/lib/libncursesw.a"
register_shell+=" /bin/bash"
register_shell+=" /usr/bin/bash"
make_dirs="/etc/bash/bashrc.d 755 root root"
conflicts="chroot-bash>=0"
alternatives+=" sh:sh:/usr/bin/bash"
alternatives+=" sh:sh.1:/usr/share/man/man1/bash.1"

CFLAGS="-DSYS_BASHRC='\"/etc/bash/bashrc\"'"

post_patch() {
  cd "$wrksrc"
  for _p in $(seq -w 001 $_bash_patchlevel); do
    msg_normal " Applying patch $_patchprefix-$_p.\n"
    patch -sNp0 -i "$XBPS_SRCDISTDIR/bash-$version/$_patchprefix-$_p"
  done
}

do_check() {
  make tests
}

post_install() {
  rm -rf "$DESTDIR/usr/share/doc"
  ln -s bash "$DESTDIR/usr/bin/rbash"
  vinstall "$FILESDIR/bashrc" 644 etc/bash
  vinstall "$FILESDIR/bash.sh" 644 etc/profile.d
}

bash-devel_package() {
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/bash
    vmove usr/lib/pkgconfig
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
