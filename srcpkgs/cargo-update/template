maintainer="nox"
pkgname="cargo-update"
version=13.0.0
revision=2
short_desc="Cargo subcommand for updates to installed executables"
makedepends+=" libcurl-devel"
makedepends+=" libgit2-devel"
makedepends+=" libssh2-devel"
makedepends+=" openssl-devel"
hostmakedepends+=" go-md2man"
hostmakedepends+=" pkg-config"
homepage="https://github.com/nabijaczleweli/cargo-update"
license="MIT"
changelog="https://github.com/nabijaczleweli/cargo-update/releases"
distfiles="https://github.com/nabijaczleweli/cargo-update/archive/v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="e3229e85ec015439008e3d6acdafa0872e077595aa1d97d2ef0de8fbddb5fe3e"
build_style="cargo"
# on i686, unexpected index dir hashes are generated
if [[ "$XBPS_TARGET_MACHINE" == "i686" ]]; then
  make_check_args="-- --skip ops::assert_index_path"
fi

post_patch() {
  # upstream does not ship a lockfile and is very vocal about that being
  # the right way: https://github.com/nabijaczleweli/cargo-update/issues/50
  cargo generate-lockfile
}

post_install() {
  vlicense LICENSE
  vdoc README.md

  cd man
  for page in *.md; do
    go-md2man -in "$page" -out "${page%.md}.1"
    vman "${page%.md}.1"
  done
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
