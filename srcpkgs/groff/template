maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="groff"
version=1.22.3
revision=4
short_desc="The GNU troff text-formatting system"
makedepends="zlib-devel"
hostmakedepends+=" bison"
hostmakedepends+=" perl"
if [[ -n "$CROSS_BUILD" ]]; then
  hostmakedepends+=" groff"
fi
homepage="http://www.gnu.org/software/groff/groff.html"
license="GPL-2"
distfiles="$GNU_SITE/$pkgname/$pkgname-$version.tar.gz"
checksum="3a48a9d6c97750bfbd535feeb5be0111db6406ddb7bb79fc680809cda6d828a5"

do_configure() {
  if [[ -n "$CROSS_BUILD" ]]; then
    sed -i \
      -e '/^GROFFBIN=/s:=.*:=/usr/bin/groff:' \
      -e '/^TROFFBIN=/s:=.*:=/usr/bin/troff:' \
      -e '/^GROFF_BIN_PATH=/s:=.*:=:' \
      -e '/^GROFF_BIN_DIR=/s:=.*:=:' \
      contrib/*/Makefile.sub \
      doc/Makefile.in \
      doc/Makefile.sub
  fi
  ./configure \
    $configure_args \
    --disable-rpath \
    --without-x
}

do_build() {
  if [[ -n "$CROSS_BUILD" ]]; then
    make TROFFBIN="troff" GROFFBIN="groff" GROFF_BIN_PATH=
  else
    make
  fi
}

do_install() {
  make DESTDIR="$DESTDIR" install

  # remove unused stuff
  rm -rf "$DESTDIR/usr/lib"

  # from Arch:
  #
  # fix some issues when encoding to utf8 man pages
  # the output chars don't match keyboard chars...
  for f in man \
           mdoc; do
    cat "$FILESDIR/site.tmac" >> "$DESTDIR/usr/share/groff/site-tmac/$f.local"
  done
}

groff-doc_package() {
  short_desc+=" - documentation"
  noarch="yes"
  pkg_install() {
    vmove usr/share/doc
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
