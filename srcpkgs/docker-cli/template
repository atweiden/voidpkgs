maintainer="nox"
pkgname="docker-cli"
version=20.10.17
revision=1
short_desc="Command-line interface for the Docker daemon"
depends="git"
hostmakedepends="pkg-config"
homepage="https://www.docker.com"
license="Apache-2.0"
distfiles="https://github.com/docker/cli/archive/v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="ab2b59c2302017fea9ad2f70827e8a6f0204b557ce28e66bcb80fea262c9fbdc"
wrksrc="cli-$version"
build_style="go"
go_package="github.com/docker/cli/cmd/docker"
go_import_path="github.com/docker/cli"
_cli_ver_path="github.com/docker/cli/cli/version"
go_ldflags+=" -s -w -buildid="
go_ldflags+=" -X \"$_cli_ver_path.Version=$version\""
go_ldflags+=" -X \"$_cli_ver_path.GitCommit=tag v$version\""
system_groups="docker"

export GOFLAGS="-trimpath"

pre_build() {
  go_ldflags+=" -X \"$_cli_ver_path.BuildTime=$(date +%Y-%m-%dT%H:%M:%SZ)\""
}

post_install() {
  vcompletion contrib/completion/fish/docker.fish fish docker
  vcompletion contrib/completion/zsh/_docker zsh docker
  vcompletion contrib/completion/bash/docker bash docker
}

docker_package() {
  unset depends
  build_style="meta"
  short_desc="Docker container runtime"
  depends+=" $sourcepkg>=${version}_$revision"
  depends+=" moby"
  depends+=" tini"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
