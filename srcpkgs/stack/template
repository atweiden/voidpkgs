maintainer="nox"
pkgname="stack"
version=2.7.3
revision=1
_stackage="lts-18.5"
short_desc="Cross-platform program for developing Haskell projects"
depends+=" git"
depends+=" gmp-devel"
depends+=" iana-etc"
makedepends+=" pcre-devel"
makedepends+=" zlib-devel"
hostmakedepends+=" cabal-install"
hostmakedepends+=" pkg-config"
hostmakedepends+=" unzip"
homepage="https://haskellstack.org"
license="BSD-3-Clause"
distfiles+=" https://hackage.haskell.org/package/$pkgname-$version/$pkgname-$version.tar.gz"
distfiles+=" https://www.stackage.org/$_stackage/cabal.config>cabal.config-$_stackage"
checksum+=" 47caf8818352c7f663eb0364f48b1f4d80832ae25c31ca483416a4b74c2c5b44"
checksum+=" 322bc85f38bf6726af6e588dde381d72f0c3e89970939b6a7b5b975cabd05d1a"
skip_extraction="cabal.config-$_stackage"
nocross="yes"
nopie_files="/usr/bin/stack"

do_build() {
  cp "$XBPS_SRCDISTDIR/$pkgname-$version/cabal.config-$_stackage" cabal.config
  HOME="$PWD" cabal update
  # https://github.com/haskell/cabal/issues/7313
  HOME="$PWD" cabal new-build "$makejobs" --flag disable-git-info \
    --constraint 'lukko -ofd-locking'
}

do_install() {
  eval vbin dist-newstyle/build/*/*/*/build/stack/stack
  vlicense LICENSE
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
