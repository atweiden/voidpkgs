maintainer="nox"
pkgname="elfutils"
version=0.181
revision=1
short_desc="Utilities to handle ELF object files"
makedepends+=" bzip2-devel"
makedepends+=" liblzma-devel"
makedepends+=" zlib-devel"
if [[ "$XBPS_TARGET_LIBC" == "musl" ]]; then
  makedepends+=" argp-standalone"
  makedepends+=" musl-fts-devel"
  makedepends+=" musl-obstack-devel"
fi
hostmakedepends+=" automake"
hostmakedepends+=" libtool"
hostmakedepends+=" pkg-config"
homepage="https://sourceware.org/elfutils/"
license="GPL-3.0-or-later"
distfiles="https://sourceware.org/elfutils/ftp/$version/$pkgname-$version.tar.bz2"
checksum="29a6ad7421ec2acfee489bb4a699908281ead2cb63a20a027ce8804a165f0eb3"
build_style="gnu-configure"
configure_args+=" --disable-debuginfod"
configure_args+=" --disable-libdebuginfod"
configure_args+=" --program-prefix=eu-"

CFLAGS="-Wno-error"

post_extract() {
  if [[ "$XBPS_TARGET_LIBC" == "musl" ]]; then
    cp "$FILESDIR/error.h" lib
    cp "$FILESDIR/error.h" src
  fi
}

pre_configure() {
  autoreconf -if
}

libelf_package() {
  short_desc+=" - runtime library"
  pkg_install() {
    vmove "usr/lib/*.so*"
  }
}

elfutils-devel_package() {
  unset depends
  depends+=" libelf>=${version}_$revision"
  depends+=" $makedepends"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/pkgconfig
    vmove "usr/lib/*.a"
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
