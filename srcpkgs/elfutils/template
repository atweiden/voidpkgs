maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="elfutils"
version=0.174
revision=4
short_desc="Utilities to handle ELF object files"
makedepends+=" bzip2-devel"
makedepends+=" liblzma-devel"
makedepends+=" zlib-devel"
case "$XBPS_TARGET_MACHINE" in
  *-musl)
    makedepends+=" argp-standalone"
    makedepends+=" musl-fts-devel"
    makedepends+=" musl-obstack"
    ;;
esac
hostmakedepends+=" automake"
hostmakedepends+=" libtool"
homepage="https://sourceware.org/elfutils/"
license="GPL-3.0-or-later"
distfiles="https://sourceware.org/elfutils/ftp/$version/$pkgname-$version.tar.bz2"
checksum="f7ef925541ee32c6d15ae5cb27da5f119e01a5ccdbe9fe57bf836730d7b7a65b"
build_style="gnu-configure"
configure_args="--program-prefix=eu-"
reverts="0.175_1"

CFLAGS="-Wno-error"
if [[ -n "$CROSS_BUILD" ]]; then
  # kernel headers in our cross-* packages are too old (need >= 4.1)
  CFLAGS+=" -DBPF_PSEUDO_MAP_FD=1"
fi

post_extract() {
  case "$XBPS_TARGET_MACHINE" in
    *-musl)
      cp "$FILESDIR/error.h" lib
      cp "$FILESDIR/error.h" src
  esac
}

pre_configure() {
  autoreconf -if
}

libelf_package() {
  short_desc+=" - runtime library"
  pkg_install() {
    vmove "usr/lib/*.so*"
    vmove usr/lib/elfutils
  }
}

elfutils-devel_package() {
  depends="libelf>=${version}_$revision"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/pkgconfig
    vmove "usr/lib/*.a"
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
