# NOTE: keep this package synchronized with "srcpkgs/xbps"
maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="xbps-static"
version=0.57.1
revision=3
short_desc="XBPS package system utilities - static binaries"
# only musl
archs="*-musl"
depends="xbps-triggers"
makedepends="libarchive-devel"
hostmakedepends="pkg-config"
homepage="https://www.voidlinux.org/xbps"
license="BSD-2-Clause"
changelog="https://github.com/void-linux/xbps/blob/master/NEWS"
distfiles="https://github.com/void-linux/xbps/archive/$version.tar.gz>$pkgname-$version.tar.gz"
checksum="bccad7c4187c467f322e6905fbe96839c00d2cbdda254c0c99b38eabeedb8678"
wrksrc="xbps-$version"
build_style="configure"

# lto objects break static builds, override
CFLAGS="-fno-lto"
LDFLAGS="-fno-lto"

do_configure() {
  ./configure \
    --enable-static \
    --prefix="/usr" \
    --sysconfdir="/etc"
}

do_install() {
  make DESTDIR="$wrksrc/static-install" install
  vmkdir usr/bin
  mv "$wrksrc/static-install/usr/bin"/*.static "$DESTDIR/usr/bin"
}

post_install() {
  vlicense LICENSE
  vlicense LICENSE.3RDPARTY
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
