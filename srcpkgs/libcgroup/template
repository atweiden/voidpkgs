maintainer="nox"
pkgname="libcgroup"
version=2.0.2
revision=1
short_desc="Library that abstracts the control group file system in Linux"
makedepends="pam-devel"
hostmakedepends="flex"
homepage="https://github.com/libcgroup/libcgroup"
license="LGPL-2.1-only"
distfiles="https://github.com/libcgroup/libcgroup/releases/download/v$version/$pkgname-$version.tar.gz"
checksum="8ef63b32e0aff619547dbb8a25e1f6bab152d7c4864795cf915571a5994d0cf8"
build_style="gnu-configure"
configure_args+=" --enable-pam-module-dir=/usr/lib/security"
configure_args+=" --sbindir=/usr/bin"
make_dirs="/etc/cgconfig.d 0755 root root"

case "$XBPS_TARGET_MACHINE" in
  *-musl)
    # add musl-fts implementation
    makedepends+=" musl-fts-devel"
    LDFLAGS="-lfts"
    ;;
esac

post_configure() {
  # disable tests
  sed \
    -i \
    -e "/SUBDIRS =/ s; tests;;" \
    Makefile
}

libcgroup-utils_package() {
  unset conf_files
  short_desc+=" - utilities"
  conf_files+=" /etc/cgconfig.conf"
  conf_files+=" /etc/cgrules.conf"
  system_groups="cgred"
  pkg_install() {
    vmove usr/bin
    vmove usr/share/man
    vconf samples/cgrules.conf
    vconf samples/cgconfig.conf
    vsv cgred
  }
}

libcgroup-devel_package() {
  depends="$sourcepkg>=${version}_$revision"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/pkgconfig
    vmove "usr/lib/*.so"
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
