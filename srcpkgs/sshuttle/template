maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="sshuttle"
version=0.78.4
revision=2
short_desc="Transparent proxy server that forwards TCP packets over ssh"
noarch="yes"
depends+=" iptables"
depends+=" python3-setuptools"
hostmakedepends+=" python3-Sphinx"
hostmakedepends+=" python3-setuptools"
homepage="https://github.com/sshuttle/sshuttle"
license="LGPL-2.1-or-later"
distfiles="$PYPI_SITE/s/sshuttle/sshuttle-$version.tar.gz"
checksum="30c1d8f62486b3eb7f565f00a75e0ffc7166af9a88da87cd8338b3d3e620135f"
build_style="python3-module"
pycompile_module="sshuttle"

post_extract() {
  sed \
    -i \
    -e '/setup_requires=/d' \
    -e '/use_scm_version/,+3d' \
    -e "/name=/ a\
    version='$version'," \
    setup.py
  # BUG: wrong permissions (https://github.com/sshuttle/sshuttle/issues/217)
  chmod -R go+rX .
}

post_install() {
  make -C docs man
  vman docs/_build/man/sshuttle.1
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
