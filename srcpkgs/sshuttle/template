maintainer="nox"
pkgname="sshuttle"
version=1.1.1
revision=2
short_desc="Transparent proxy server that forwards TCP packets over ssh"
depends="python3-psutil"
checkdepends+=" python3-flake8"
checkdepends+=" python3-mock"
checkdepends+=" python3-pytest"
hostmakedepends+=" python3-Sphinx"
hostmakedepends+=" python3-setuptools_scm"
homepage="https://github.com/sshuttle/sshuttle"
license="LGPL-2.1-or-later"
changelog="https://github.com/sshuttle/sshuttle/raw/master/CHANGES.rst"
distfiles="$PYPI_SITE/s/sshuttle/$pkgname-$version.tar.gz"
checksum="f5a3ed1e5ab1213c7a6df860af41f1a903ab2cafbfef71f371acdcff21e69ee6"
build_style="python3-module"

post_extract() {
  # BUG: wrong permissions (https://github.com/sshuttle/sshuttle/issues/217)
  chmod -R go+rX .
}

pre_check() {
  sed \
    -i \
    -e '/addopts/d' \
    setup.cfg
}

post_install() {
  make -C docs man
  vman docs/_build/man/sshuttle.1
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
