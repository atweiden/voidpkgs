maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="ghc"
# keep this synchronized with http://www.stackage.org/lts
version=8.4.3
revision=1
short_desc="Glorious Haskell Compiler"
depends+=" gcc"
depends+=" gmp-devel"
depends+=" libffi-devel"
depends+=" libnuma-devel"
depends+=" perl"
makedepends+=" gmp-devel"
makedepends+=" libffi-devel"
makedepends+=" libnuma-devel"
makedepends+=" ncurses-devel"
hostmakedepends+=" automake"
hostmakedepends+=" docbook-xsl"
hostmakedepends+=" ghc-bin"
hostmakedepends+=" libxslt"
hostmakedepends+=" python-Sphinx"
homepage="http://www.haskell.org/ghc/"
license="BSD"
distfiles="http://www.haskell.org/ghc/dist/${version%[!0-9]}/$pkgname-${version%[!0-9]}-src.tar.xz"
checksum="ae47afda985830de8811243255aa3744dfb9207cb980af74393298b2b62160d6"
wrksrc="ghc-${version%[!0-9]}"
patch_args="-Np1"
build_style="gnu-configure"
configure_args="--with-system-libffi"
# ask leah2 before wasting time trying to do that
nocross="yes"
_bindir="/usr/lib/$pkgname-$version/bin"
nopie_files+=" $_bindir/ghc"
nopie_files+=" $_bindir/ghc-iserv"
nopie_files+=" $_bindir/ghc-iserv-dyn"
nopie_files+=" $_bindir/ghc-iserv-prof"
nopie_files+=" $_bindir/ghc-pkg"
nopie_files+=" $_bindir/haddock"
nopie_files+=" $_bindir/hp2ps"
nopie_files+=" $_bindir/hpc"
nopie_files+=" $_bindir/hsc2hs"
nopie_files+=" $_bindir/runghc"
nopie_files+=" $_bindir/unlit"

pre_configure() {
  export CONF_CC_OPTS_STAGE0="$CFLAGS_FOR_BUILD"
  export CONF_CC_OPTS_STAGE1="$CFLAGS"
  export CONF_CC_OPTS_STAGE2="$CFLAGS"
  export CONF_GCC_LINKER_OPTS_STAGE0="$LDFLAGS_FOR_BUILD"
  export CONF_GCC_LINKER_OPTS_STAGE1="$LDFLAGS"
  export CONF_GCC_LINKER_OPTS_STAGE2="$LDFLAGS"
  export CONF_CPP_OPTS_STAGE0="$CPPFLAGS_FOR_BUILD"
  export CONF_CPP_OPTS_STAGE1="$CPPFLAGS"
  export CONF_CPP_OPTS_STAGE2="$CPPFLAGS"
  autoreconf -fi
}

post_install() {
  sed -i 's#/usr/lib/ccache/bin/##g' "$DESTDIR/usr/lib/ghc-${version%[!0-9]}/settings"
  vlicense LICENSE
}

ghc-doc_package() {
  noarch="yes"
  short_desc+=" -- documentation"
  pkg_install() {
    vmove usr/share/doc
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
