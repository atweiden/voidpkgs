maintainer="nox"
pkgname="lsof"
version=4.99.0
revision=1
short_desc="LiSt Open Files"
checkdepends+=" procps-ng"
checkdepends+=" util-linux"
hostmakedepends+=" automake"
hostmakedepends+=" groff"
homepage="https://github.com/lsof-org/lsof"
license="lsof"
changelog="https://github.com/lsof-org/lsof/raw/master/00DIST"
distfiles="https://github.com/lsof-org/lsof/releases/download/$version/$pkgname-$version.tar.gz"
checksum="180e6284aff184d94d273e34f7264edc2af849c07b1c5d6a4183d4d402734245"
build_style="gnu-configure"
configure_args="--enable-security"

post_extract() {
  # ensure tests always run
  ln -sf /bin/true tests/CkTestDB

  # skip tests/ltsock on github ci
  # hostname/ip resolution fails in ci container
  if [[ "$XBPS_BUILD_ENVIRONMENT" == "void-packages-ci" ]]; then
    vsed \
      -i \
      -e '/^TESTS +=/s:tests/LTsock::g' \
      Makefile.am
  fi

  # liblsof is still in alpha, don't include it in the package
  vsed \
    -i \
    -e '/^lib_LTLIBRARIES/s/^lib_/noinst_/; /^include_HEADERS/d' \
    Makefile.am
}

post_install() {
  vlicense COPYING
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
