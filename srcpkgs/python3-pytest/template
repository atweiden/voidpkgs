maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="python3-pytest"
version=5.3.2
revision=1
short_desc="Simple powerful testing with Python 3"
archs="noarch"
depends+=" python3-atomicwrites"
depends+=" python3-attrs"
depends+=" python3-importlib_metadata"
depends+=" python3-more-itertools"
depends+=" python3-packaging"
depends+=" python3-pluggy"
depends+=" python3-py"
depends+=" python3-wcwidth"
checkdepends+=" $depends"
checkdepends+=" python3-argcomplete"
checkdepends+=" python3-hypothesis"
checkdepends+=" python3-mock"
checkdepends+=" python3-nose"
checkdepends+=" python3-parsing"
checkdepends+=" python3-requests"
checkdepends+=" tox"
hostmakedepends="python3-setuptools"
homepage="https://docs.pytest.org/en/latest/"
license="MIT"
changelog="https://docs.pytest.org/en/latest/changelog.html"
distfiles="$PYPI_SITE/p/pytest/pytest-$version.tar.gz"
checksum="6b571215b5a790f9b41f19f3531c53a45cf6bb8ef2988bc1ff9afb38270b25fa"
wrksrc="${pkgname/python3-//}-$version"
build_style="python3-module"
pycompile_module="_pytest pytest.py"
alternatives+=" pytest:pytest:/usr/bin/pytest3"
alternatives+=" pytest:py.test:/usr/bin/py.test3"

post_patch() {
  sed \
    -i \
    -e '/setup_requires=/d' \
    -e "s|use_scm_version=.*|version=\"$version\",|" \
    setup.py
}

do_check() {
  tox -e py36
}

post_install() {
  mv "$DESTDIR/usr/bin/pytest" "$DESTDIR/usr/bin/pytest3"
  mv "$DESTDIR/usr/bin/py.test" "$DESTDIR/usr/bin/py.test3"
  vlicense LICENSE
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
