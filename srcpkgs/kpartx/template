maintainer="nox"
pkgname="kpartx"
version=0.8.4
revision=1
short_desc="Create device maps from partition tables"
makedepends="device-mapper-devel"
homepage="http://christophe.varoqui.free.fr/"
license="GPL-2.0-or-later"
distfiles="https://git.opensvc.com/?p=multipath-tools/.git;a=snapshot;h=refs/tags/$version>$pkgname-$version.tar.gz"
checksum="ccd73bf67621161d9e42d1a770c3a7efff6e252433e8b8ed5f64a88cb5e7151d"
wrksrc="multipath-tools-$version"
build_wrksrc="kpartx"
build_style="gnu-makefile"
make_install_args+=" bindir=/usr/bin"
make_install_args+=" libudevdir=/usr/lib/udev"

CFLAGS+=" -DLIBDM_API_COOKIE"
CFLAGS+=" -D_FILE_OFFSET_BITS=64"
CFLAGS+=" -D_LARGEFILE64_SOURCE"
CFLAGS+=" -I../libmultipath"
LDFLAGS="-ldevmapper"

post_extract() {
  sed \
    -i \
    -e 's/__kernel_uint32_t/uint32_t/g' \
    kpartx/solaris.c
  sed \
    -i \
    -e 's,<sysmacros.h>,<sys/sysmacros.h>,g' \
    kpartx/lopart.c
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
