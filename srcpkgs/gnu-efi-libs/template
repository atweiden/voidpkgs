maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="gnu-efi-libs"
version=3.0.8
revision=2
short_desc="Library for building UEFI Applications using GNU toolchain"
makedepends="pciutils-devel"
homepage="http://sourceforge.net/projects/gnu-efi/"
license="GPL-2.0-or-later"
distfiles="$SOURCEFORGE_SITE/gnu-efi/gnu-efi-$version.tar.bz2"
checksum="76006d8ea8d67bcf72f35d09d43e9ef6a69400d6d5d4bf64baf1ab7434e2b722"
wrksrc="gnu-efi-$version"
nostrip="yes"
# not an actual revert, xbps considers 3.0w higher than 3.0.8
reverts="3.0w_1"

do_build() {
  unset CFLAGS
  unset CPPFLAGS
  unset CXXFLAGS
  unset LDFLAGS
  make lib gnuefi inc apps
}

do_install() {
  make \
    INSTALLROOT="$DESTDIR" \
    LIBDIR="/usr/lib" \
    PREFIX="/usr" \
    install

  case "$XBPS_TARGET_MACHINE" in
    i686*)
      _EFI_ARCH="ia32"
      ;;
    x86_64*)
      _EFI_ARCH="x86_64"
      ;;
  esac
  vmkdir "usr/share/gnu-efi/apps/$_EFI_ARCH"

  if [[ "${XBPS_MACHINE%-musl}" == "i686" ]]; then
    HOST_ARCH="ia32"
  else
    HOST_ARCH="${XBPS_MACHINE/-musl//}"
  fi

  install -Dm 644 "$HOST_ARCH/apps"/*.efi "$DESTDIR/usr/share/gnu-efi/apps/$_EFI_ARCH"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
