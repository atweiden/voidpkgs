maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="libtomcrypt"
version=1.18.2
revision=1
short_desc="Fairly comprehensive, modular and portable cryptographic toolkit"
hostmakedepends="libtool"
homepage="http://www.libtom.net/?page=features&newsitems=5&whatfile=crypt"
license="Public domain"
distfiles="https://github.com/libtom/libtomcrypt/releases/download/v$version/crypt-$version.tar.xz"
checksum="96ad4c3b8336050993c5bc2cf6c057484f2b0f9f763448151567fbab5e767b84"
patch_args="-Np1"

do_build() {
  sed -e "s,@@CC@@,$CC,g;s,\$(CC),$CC,g" -i makefile.shared
  if [[ -n "$CROSS_BUILD" ]]; then
    cp /usr/bin/libtool .
    sed -e "s,CCLD=.*,CCLD=$CC,g;s,CC=.*,CC=$CC,g" -i libtool
    sed -e 's,libtool,./libtool,g' -i makefile.shared
  fi
  make RANLIB="$RANLIB" -f makefile.shared "$makejobs"
}

do_check() {
  make test
  ./test
}

do_install() {
  make -f makefile.shared GROUP="$(whoami)" USER="$(whoami)" NODOCS=1 DESTDIR="$DESTDIR" PREFIX="/usr" install
  vman "$sourcepkg.3"
}

libtomcrypt-devel_package() {
  depends="$sourcepkg>=${version}_$revision"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/pkgconfig
    vmove "usr/lib/*.a"
    vmove "usr/lib/*.so"
    vmove usr/share/man/man3
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
