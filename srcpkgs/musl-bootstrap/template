maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="musl-bootstrap"
version=1.1.20
revision=2
short_desc="The musl C library (bootstrap pkg)"
homepage="http://www.musl-libc.org/"
license="MIT"
distfiles="http://www.musl-libc.org/releases/musl-$version.tar.gz"
checksum="44be8771d0e6c6b5f82dd15662eb2957c9a3173a19a8b49966ac0542bbd40d61"
wrksrc="musl-$version"
build_style="configure"
configure_args="--prefix=/usr/lib/musl"
make_build_args+=" ALL_TOOLS+=obj/musl-gcc"
make_build_args+=" ALL_TOOLS+=obj/musl-clang"
make_build_args+=" ALL_TOOLS+=obj/ld.musl-clang"
make_install_args="$make_build_args"
lib32disabled="yes"

post_install() {
  mv "$DESTDIR/lib"/* "$DESTDIR/usr/lib/"
  # cc is an alternative and might actually be clang
  sed \
    -i \
    -e "s/REALGCC:-cc/REALGCC:-gcc/" \
    "$DESTDIR/usr/lib/musl/bin/musl-gcc"
  vmkdir usr/bin
  ln -sfr "$DESTDIR/usr/lib/musl/bin/musl-gcc" "$DESTDIR/usr/bin/musl-gcc"
  ln -sfr "$DESTDIR/usr/lib/musl/bin/musl-clang" "$DESTDIR/usr/bin/musl-clang"
  ln -sfr "$DESTDIR/usr/lib/musl/bin/ld.musl-clang" "$DESTDIR/usr/bin/ld.musl-clang"
  vlicense COPYRIGHT
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
