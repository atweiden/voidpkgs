maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="erlang"
version=21.2
revision=1
short_desc="Concurrent functional programming language developed by Ericsson"
makedepends+=" libressl-devel"
makedepends+=" ncurses-devel"
makedepends+=" unixodbc-devel"
makedepends+=" zlib-devel"
hostmakedepends+=" libxslt"
hostmakedepends+=" perl"
license="Apache-2.0"
homepage="http://www.erlang.org/"
distfiles+=" http://erlang.org/download/otp_src_$version.tar.gz"
distfiles+=" http://erlang.org/download/otp_doc_man_$version.tar.gz"
checksum+=" f6b07bf8e6705915679a63363ce80faaa6b7c231e7236cde443d6445f7430334"
checksum+=" e85a782e0fcd38b92098110b320e28ea8030cce318868d99a4fe6d17ae08b778"
create_wrksrc="yes"
build_wrksrc="otp_src_$version"
build_style="gnu-configure"

pre_configure() {
  if [[ -n "$CROSS_BUILD" ]]; then
    # build the bootstrap compiler for the host platform
    env - PATH="/usr/bin:/usr/sbin" ./configure --enable-bootstrap-only
    env - PATH="/usr/bin:/usr/sbin" HOME="$HOME" make "$makejobs"
    configure_args+=" --build=$(erts/autoconf/config.guess)"
    export erl_xcomp_sysroot="/usr/$XBPS_CROSS_TRIPLET"
  fi
}

post_configure() {
  sed \
    -i \
    -e '/LDFLAGS =/s/=/+=/' \
    lib/odbc/c_src/*/Makefile
}

post_install() {
  vmkdir usr/share/man
  vmkdir usr/lib/erlang/man
  vcopy ../man/man1 usr/share/man
  vcopy ../man/man3 usr/lib/erlang/man
  vcopy ../man/man4 usr/lib/erlang/man
  vcopy ../man/man7 usr/lib/erlang/man
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
