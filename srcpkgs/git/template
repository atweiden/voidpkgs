maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="git"
version=2.18.0
revision=1
short_desc="Git Tree History Storage Tool"
depends+=" ca-certificates"
depends+=" perl-Authen-SASL"
depends+=" perl-MIME-tools"
depends+=" perl-Net-SMTP-SSL"
makedepends+=" libcurl-devel"
makedepends+=" pcre2-devel"
hostmakedepends+=" asciidoc"
hostmakedepends+=" perl"
hostmakedepends+=" xmlto"
homepage="https://git-scm.com/"
license="GPL-2.0-only"
changelog="https://raw.githubusercontent.com/git/git/master/Documentation/RelNotes/$version.txt"
distfiles="https://www.kernel.org/pub/software/scm/git/git-$version.tar.xz"
checksum="8b40be383a603147ae29337136c00d1c634bdfdc169a30924a024596a7e30e92"
build_style="gnu-configure"
configure_args+=" --with-curl"
configure_args+=" --with-expat"
configure_args+=" --with-libpcre2"
configure_args+=" --without-tcltk"
configure_args+=" ac_cv_fread_reads_directories=no"
configure_args+=" ac_cv_snprintf_returns_bogus=no"
make_install_args+=" INSTALLDIRS=vendor"
make_install_args+=" NO_INSTALL_HARDLINKS=1"
make_install_args+=" perllibdir=/usr/share/perl5/vendor_perl"
make_check_target="test"
replaces="git-perl>=0"

post_build() {
  make "$makejobs" -C Documentation man
  make "$makejobs" -C contrib/subtree all git-subtree.1
}

post_install() {
  make NO_INSTALL_HARDLINKS=1 DESTDIR="$DESTDIR" install-doc
  vinstall contrib/completion/git-completion.bash 644 \
    usr/share/bash-completion/completions git
  vinstall contrib/completion/git-prompt.sh 644 usr/share/git
  make -C contrib/subtree DESTDIR="$DESTDIR" prefix="/usr" install install-man
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
