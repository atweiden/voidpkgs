maintainer="nox"
pkgname="dbus"
version=1.12.18
revision=1
short_desc="Message bus system"
makedepends+=" expat-devel"
makedepends+=" libcap-devel"
hostmakedepends+=" gperf"
hostmakedepends+=" intltool"
hostmakedepends+=" pkg-config"
hostmakedepends+=" xmlto"
homepage="https://dbus.freedesktop.org/"
license="GPL-2.0-or-later"
changelog="https://github.com/freedesktop/dbus/raw/dbus-${version%.*}/NEWS"
distfiles="https://dbus.freedesktop.org/releases/$pkgname/$pkgname-$version.tar.gz"
checksum="64cf4d70840230e5e9bc784d153880775ab3db19d656ead8a0cb9c0ab5a95306"
conf_files="/etc/dbus-1/*.conf"
build_style="gnu-configure"
configure_args+=" --disable-asserts"
configure_args+=" --disable-doxygen-docs"
configure_args+=" --disable-selinux"
configure_args+=" --disable-systemd"
configure_args+=" --disable-user-session"
configure_args+=" --disable-x11-autolaunch"
configure_args+=" --enable-epoll"
configure_args+=" --enable-inotify"
configure_args+=" --enable-xml-docs"
configure_args+=" --with-console-auth-dir=/run/console"
configure_args+=" --with-dbus-user=dbus"
configure_args+=" --with-gnu-ld"
configure_args+=" --with-system-pid-file=/run/dbus/pid"
configure_args+=" --with-system-socket=/run/dbus/system_bus_socket"
configure_args+=" --without-x"
python_version=3

# Create dbus:22 system account.
system_accounts="dbus:22"

post_install() {
  vsv dbus
}

dbus-devel_package() {
  depends+=" dbus-libs>=${version}_$revision"
  depends+=" expat-devel"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove "usr/lib/dbus-*"
    vmove usr/lib/pkgconfig
    vmove "usr/lib/*.a"
    vmove "usr/lib/*.so"
    vmove usr/share/doc
    vmove usr/lib/cmake
  }
}

dbus-libs_package() {
  short_desc+=" - shared libraries"
  pkg_install() {
    vmove "usr/lib/*.so.*"
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
