maintainer="nox"
pkgname="soju"
version=0.6.2
revision=2
short_desc="User-friendly IRC bouncer"
makedepends="sqlite-devel"
hostmakedepends="scdoc"
homepage="https://soju.im"
license="AGPL-3.0-or-later"
changelog="https://git.sr.ht/~emersion/soju/refs"
distfiles="https://git.sr.ht/~emersion/soju/refs/download/v$version/$pkgname-$version.tar.gz"
checksum="b8a8f5af08670497d233137086e273a26c388f5e313c9e9e613ef6caaa3e928a"
conf_files="/etc/soju/config"
build_style="go"
go_import_path="git.sr.ht/~emersion/soju"
go_package="./cmd/..."
go_build_tags+=" libsqlite3"
go_build_tags+=" netgo"
go_build_tags+=" osusergo"
go_ldflags="-buildid="
if [[ "$XBPS_TARGET_LIBC" == "musl" ]]; then
  go_build_tags+=" sqlite_omit_load_extension"
  go_ldflags+=" -extldflags=-static"
  go_ldflags+=" -linkmode=external"
fi
system_accounts="_soju"
make_dirs+=" /var/db/soju 0750 _soju _soju"
make_dirs+=" /var/log/soju 0750 _soju _soju"

export GOFLAGS="-trimpath"

post_install() {
  for f in doc/*.?.scd; do
    scdoc <"$f" >"${f%.scd}"
    vman "${f%.scd}"
  done
  vlicense LICENSE
  vinstall "$FILESDIR/config" 644 etc/soju
  vdoc "$FILESDIR/README.voidlinux"
  vsv soju
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
