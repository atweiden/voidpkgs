maintainer="nox"
pkgname="gettext"
version=0.20.2
revision=2
short_desc="Internationalized Message Handling Library and tools"
homepage="https://www.gnu.org/software/gettext/"
license="GPL-3.0-or-later"
changelog="https://git.savannah.gnu.org/cgit/gettext.git/plain/NEWS"
distfiles="$GNU_SITE/gettext/$pkgname-$version.tar.gz"
checksum="ecb9d0908ca41d5ca5fef974323b3bba6bec19eebba0b44f396de98cfcc089f1"
build_style="gnu-configure"
configure_args+=" --disable-acl"
configure_args+=" --disable-csharp"
configure_args+=" --disable-curses"
configure_args+=" --disable-java"
configure_args+=" --disable-libasprintf"
configure_args+=" --disable-native-java"
configure_args+=" --disable-openmp"
configure_args+=" --disable-rpath"
configure_args+=" --enable-nls"
configure_args+=" --enable-threads=posix"
configure_args+=" --with-included-glib"
configure_args+=" --with-included-libcroco"
configure_args+=" --with-included-libunistring"
configure_args+=" --with-included-libxml"
configure_args+=" --without-emacs"
configure_args+=" --without-examples"
configure_args+=" --without-git"
configure_args+=" gl_cv_func_gettimeofday_clobber=no"
case "$XBPS_TARGET_MACHINE" in
  # force libintl
  *-musl)
    configure_args+=" --with-included-gettext"
    ;;
esac

if [[ -n "$CROSS_BUILD" ]]; then
  hostmakedepends+=" automake"
  hostmakedepends+=" libtool"
  pre_configure() {
    autoreconf -fi
  }
fi

post_install() {
  # fix conflict with musl
  if [[ -e "$DESTDIR/usr/include/libintl.h" ]]; then
    vmkdir usr/include/gettext
    mv "$DESTDIR/usr/include/libintl.h" "$DESTDIR/usr/include/gettext/libintl.h"
  fi
}

gettext-devel-examples_package() {
  short_desc+=" - examples for development"
  pkg_install() {
    vmove usr/share/doc/gettext
  }
}

gettext-devel_package() {
  depends+=" gettext-libs>=${version}_$revision"
  depends+=" xz"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove "usr/lib/*.a"
    vmove usr/share/aclocal
    vmove usr/share/gettext
    vmove usr/share/man/man3
    vmove usr/bin/autopoint
    vmove usr/bin/gettextize
  }
}

gettext-libs_package() {
  short_desc+=" - shared libraries"
  pkg_install() {
    vmove "usr/lib/*.so*"
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
