maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="zsh"
version=5.6.1
revision=1
short_desc="The Z SHell"
makedepends+=" gdbm-devel"
makedepends+=" libcap-devel"
makedepends+=" ncurses-devel"
makedepends+=" pcre-devel"
hostmakedepends+=" autoconf"
hostmakedepends+=" automake"
hostmakedepends+=" m4"
homepage="http://www.zsh.org"
license="MIT, GPL-3.0-or-later"
changelog="https://raw.githubusercontent.com/zsh-users/$pkgname/master/ChangeLog"
distfiles="https://github.com/zsh-users/$pkgname/archive/$pkgname-$version.tar.gz"
checksum="c8d0faf9c131290b16be995a8eb7e884b4c6c5cc7d33dd3a3f2b6b9a06902050"
wrksrc="$pkgname-$pkgname-$version"
build_style="gnu-configure"
configure_args+=" --enable-cap"
configure_args+=" --enable-etcdir=/etc/zsh"
configure_args+=" --enable-fndir=/usr/share/zsh/functions"
configure_args+=" --enable-function-subdirs"
configure_args+=" --enable-maildir-support"
configure_args+=" --enable-multibyte"
configure_args+=" --enable-pcre"
configure_args+=" --enable-scriptdir=/usr/share/zsh/scripts"
configure_args+=" --enable-zlogin=/etc/zsh/zlogin"
configure_args+=" --enable-zlogout=/etc/zsh/zlogout"
configure_args+=" --enable-zprofile=/etc/profile"
configure_args+=" --enable-zshenv=/etc/zsh/zshenv"
configure_args+=" --enable-zshrc=/etc/zsh/zshrc"
configure_args+=" --with-tcsetpgrp"
configure_args+=" --with-term-lib=ncursesw"
configure_args+=" zsh_cv_func_dlsym_needs_underscore=no"
configure_args+=" zsh_cv_shared_environ=yes"
configure_args+=" zsh_cv_sys_dynamic_execsyms=yes"
make_build_target+=" all"
make_build_target+=" info"
make_install_args="install.info"
register_shell="/bin/zsh"
lib32disabled="yes"

pre_configure() {
  # set correct keymap path
  sed \
    -i \
    -e 's#/usr/share/keymaps#/usr/share/kbd/keymaps#g' \
    Completion/Unix/Command/_loadkeys
  # remove unneeded and conflicting completion scripts
  for _fpath in AIX \
                BSD \
                Cygwin \
                Darwin \
                Debian \
                Mandriva \
                Redhat \
                Solaris \
                openSUSE; do
    rm -rf "Completion/$_fpath"
    sed \
      -i \
      -e "s,\s*Completion/$_fpath/\*/\*,,g" \
      Src/Zle/complete.mdd
  done
  rm -f Completion/Linux/Command/_{pkgtool,rpmbuild,yast}
  rm -f Completion/Unix/Command/_{notmuch,osc,systemd}

  ./Util/preconfig
}

post_install() {
  vlicense LICENCE
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
