maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="proot"
version=5.1.0
revision=5
short_desc="User-space implementation of chroot, mount --bind, and binfmt_misc"
makedepends+=" libarchive-devel"
makedepends+=" talloc-devel"
homepage="https://proot-me.github.io"
license="GPL-2"
distfiles="https://github.com/proot-me/PRoot/archive/v$version.tar.gz"
checksum="50fcb882662b2de3e64e603b68d1af75e920d480191a49e11c0cb63d50040386"
wrksrc="PRoot-$version"

pre_build() {
  sed \
    -i \
    -e "s,strip,:,g" \
    -e "s,objcopy,$OBJCOPY,g" \
    -e "s,objdump,$OBJDUMP,g" \
    -e "s,--input ,--input-target ,g" \
    -e "s,--output ,--output-target ,g" \
    src/GNUmakefile
  # fix glibc ptrace.h specific constants for musl libc
  cp "$FILESDIR/ptrace_compat.h" "$wrksrc/src"
}

do_build() {
  cd src
  make CC="$CC" CFLAGS="$CFLAGS" "$makejobs"
}

do_install() {
  vbin src/proot
}

post_install() {
  vman doc/proot/man.1 proot.1
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
