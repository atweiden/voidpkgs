maintainer="nox"
pkgname="keybase"
version=5.4.0
revision=1
short_desc="Client for keybase.io"
depends="gnupg2"
hostmakedepends="git"
homepage="https://keybase.io/"
license="BSD-3-Clause"
distfiles="https://github.com/keybase/client/archive/v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="a6f93baad9720389e963496222e5efcda80297dac68968c1ce363bd60f1e4fb4"
wrksrc="client-$version"
build_style="go"
go_import_path="github.com/keybase/client"
go_package+=" $go_import_path/go/keybase"
go_package+=" $go_import_path/go/kbfs/kbfsfuse"
go_package+=" $go_import_path/go/kbfs/kbfsgit/git-remote-keybase"
go_package+=" $go_import_path/go/kbfs/kbfstool"
go_package+=" $go_import_path/go/kbfs/redirector"
go_build_tags="production"

export GOFLAGS="-trimpath"

post_install() {
  vlicense LICENSE
}

kbfs_package() {
  unset depends
  depends+=" fuse"
  depends+=" keybase"
  short_desc="Keybase Filesystem"
  pkg_install() {
    vmove usr/bin/redirector
    mv \
      "$PKGDESTDIR/usr/bin/redirector" \
      "$PKGDESTDIR/usr/bin/keybase-redirector"
    # setuid
    chmod 4755 "$PKGDESTDIR/usr/bin/keybase-redirector"
    vmove usr/bin/kbfsfuse
    vmove usr/bin/kbfstool
    vmove usr/bin/git-remote-keybase
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
