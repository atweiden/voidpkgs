maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="packer"
version=1.3.0
revision=1
short_desc="Create identical multiplatform machine images from a single source"
hostmakedepends="git"
homepage="http://www.packer.io"
license="MPL-2"
distfiles="https://github.com/hashicorp/packer/archive/v$version.tar.gz"
checksum="ae53bea6434959dd56926546a26196dba4de1b480aaa893dec235ff70e1aee29"
build_style="go"
go_import_path="github.com/hashicorp/packer"
replaces="packer-bin>=0"

case "$XBPS_TARGET_MACHINE" in
  i686*|arm*)
    broken="https://build.voidlinux.eu/builders/i686_builder/builds/9375/steps/shell_3/logs/stdio"
    ;;
esac

post_build() {
  for F in $(find -type f -name main.go); do
    go get -x "$go_import_path/${F%/*}"
  done
}

do_install() {
  find "$GOPATH/bin" -type f -executable | while read line; do
    if [[ "$(basename "$line")" == "packer" ]]; then
      vbin "$line"
    else
      vbin "$line" "packer-$(basename "$line")"
    fi
  done
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
