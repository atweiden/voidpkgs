maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="packer"
version=1.3.1
revision=1
short_desc="Create identical multiplatform machine images from a single source"
hostmakedepends="git"
homepage="http://www.packer.io"
license="MPL-2"
distfiles="https://github.com/hashicorp/packer/archive/v$version.tar.gz>$pkgname-$version.tar.gz"
checksum="1e577ad25c98bf1b57d738c195cd611ee98b91fd2934f8002dac43cfd26ad5fd"
build_style="go"
go_import_path="github.com/hashicorp/packer"
replaces="packer-bin>=0"

case "$XBPS_TARGET_MACHINE" in
  i686*|arm*)
    broken="https://build.voidlinux.eu/builders/i686_builder/builds/9375/steps/shell_3/logs/stdio"
    ;;
esac

post_build() {
  for F in $(find -type f -name main.go); do
    go get -x "$go_import_path/${F%/*}"
  done
}

do_install() {
  find "$GOPATH/bin" -type f -executable | while read line; do
    if [[ "$(basename "$line")" == "packer" ]]; then
      vbin "$line"
    else
      vbin "$line" "packer-$(basename "$line")"
    fi
  done
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
