maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="wpa_supplicant"
version=2.6
revision=9
short_desc="WPA/WPA2/IEEE 802.1X Supplicant"
makedepends+=" dbus-devel"
makedepends+=" libnl3-devel"
makedepends+=" libressl-devel"
makedepends+=" readline-devel"
hostmakedepends="pkg-config"
homepage="http://w1.fi/wpa_supplicant/"
license="BSD-3-Clause"
distfiles="http://w1.fi/releases/$pkgname-$version.tar.gz"
checksum="b4936d34c4e6cdd44954beba74296d964bc2c9668ecaa5255e499636fe2b1450"
conf_files="/etc/$pkgname/$pkgname.conf"
build_wrksrc="$pkgname"

pre_build() {
  sed -i 's|/usr/local|$(PREFIX)|g' Makefile
  cp -f "$FILESDIR/config" .config
  sed -i 's, -u, -uq,' dbus/*.service.in
}

do_build() {
  export CFLAGS+=" $(pkg-config --cflags libnl-3.0) $CPPFLAGS"
  make \
    "$makejobs" \
    BINDIR="/usr/bin" \
    PREFIX="/usr" \
    V=1
}

do_install() {
  make \
    BINDIR="/usr/bin" \
    DESTDIR="$DESTDIR" \
    PREFIX="/usr" \
    install

  vinstall "$FILESDIR/$pkgname.conf" 640 "etc/$pkgname"
  vsconf wpa_supplicant.conf

  for d in doc/docbook/*.[58]; do
    vman "$d"
  done
  install -d "$DESTDIR/usr/share/dbus-1/system-services"
  install -m 644 dbus/*.service "$DESTDIR/usr/share/dbus-1/system-services/"
  vinstall "dbus/dbus-$pkgname.conf" 644 etc/dbus-1/system.d "$pkgname.conf"

  rm "$DESTDIR/usr/share/man/man8/wpa_gui.8"

  vsv wpa_supplicant
}

post_install() {
  vlicense README
}

# vim: set filetype=sh foldmethod=marker foldlevel=0:
