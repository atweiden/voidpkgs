maintainer="nox"
pkgname="libimobiledevice"
version=1.2.0
revision=15
short_desc="Library to communicate with Apple devices"
makedepends+=" libglib-devel"
makedepends+=" libplist-devel"
makedepends+=" libressl-devel"
makedepends+=" libusb-devel"
makedepends+=" libusbmuxd-devel"
makedepends+=" python3-devel"
hostmakedepends+=" automake"
hostmakedepends+=" libtool"
hostmakedepends+=" pkgconf"
hostmakedepends+=" python3-Cython"
homepage="https://github.com/libimobiledevice/libimobiledevice"
license="LGPL-2.1-only"
distfiles="https://github.com/libimobiledevice/libimobiledevice/archive/$version.tar.gz>$pkgname-$version.tar.gz"
checksum="8ba1ea817691b3548b83371f8ec22d73d1e37f8fda7c899ac9c7121d924ca830"
build_style="gnu-configure"
if [[ -n "$CROSS_BUILD" ]]; then
  configure_args+=" ac_cv_sys_file_offset_bits=yes"
  configure_args+=" ac_cv_sys_large_file=yes"
fi

pre_configure() {
  sed \
    -i \
    -e 's,SSLv3_,SSLv23_,g' \
    src/idevice.c
  sed \
    -i \
    -e 's,-L$(libdir),,g' \
    cython/Makefile.am
  export PYTHON_CPPFLAGS="-I$XBPS_CROSS_BASE/usr/include/python$py3_ver"
  export PYTHON_LDFLAGS="-L$XBPS_CROSS_BASE/usr/lib -lpython$py3_ver"
  autoreconf -fi
}

libimobiledevice-devel_package() {
  short_desc+=" - development files"
  depends+=" $makedepends"
  depends+=" $sourcepkg>=${version}_$revision"
  pkg_install() {
    vmove usr/include
    vmove "usr/lib/*.a"
    vmove "usr/lib/*.so"
    vmove usr/lib/pkgconfig
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
