maintainer="nox"
pkgname="python3-tomli"
version=1.2.1
revision=3
_flit_version=3.4.0
short_desc="Little TOML parser for Python"
depends="python3"
hostmakedepends="python3"
homepage="https://github.com/hukkin/tomli"
license="MIT"
distfiles+=" $PYPI_SITE/t/tomli/tomli-$version.tar.gz"
distfiles+=" $PYPI_SITE/f/flit_core/flit_core-$_flit_version.tar.gz"
checksum+=" a5b75cb6f3968abb47af1b40c1819dc519ea82bcc065776a866e8d74c5ca9442"
checksum+=" 29468fa2330969167d1f5c23eb9c0661cb6dacfcd46f361a274609a7f4197530"
create_wrksrc="yes"
build_wrksrc="tomli-$version"
build_style="python3-pep517"
# archive includes no tests
make_check="no"

pre_build() {
  # build requires that tomli be able to import flit_core *and* itself
  export PYTHONPATH="$PWD:$wrksrc/flit_core-$_flit_version"
}

post_install() {
  vlicense LICENSE
}

# REMARKS:
#
# flit_core>=3.4.0 requires tomli to run, while tomli requires flit_core to
# build
#
# both upstreams are aware of the cycle, but neither cares:
#
#     https://github.com/hukkin/tomli/issues/130
#     https://github.com/takluyver/flit/issues/451
#
# as a result, we can't use python3-flit_core to build this package,
# so we have to just fetch the flit_core tarball to bootstrap tomli

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
