maintainer="nox"
pkgname="pulseaudio"
version=13.0
revision=1
short_desc="Featureful, general-purpose sound server"
makedepends+=" alsa-lib-devel"
makedepends+=" eudev-libudev-devel"
makedepends+=" fftw-devel"
makedepends+=" libcap-devel"
makedepends+=" libcap-progs"
makedepends+=" libltdl-devel"
makedepends+=" libressl-devel"
makedepends+=" libsndfile-devel"
makedepends+=" libsoxr-devel"
makedepends+=" orc-devel"
makedepends+=" speex-devel"
makedepends+=" tdb-devel"
hostmakedepends+=" automake"
hostmakedepends+=" gettext-devel"
hostmakedepends+=" libtool"
hostmakedepends+=" orc-devel"
hostmakedepends+=" perl-XML-Parser"
hostmakedepends+=" pkg-config"
homepage="https://www.freedesktop.org/wiki/Software/PulseAudio"
license="LGPL-2.1-or-later"
distfiles="$FREEDESKTOP_SITE/pulseaudio/releases/$pkgname-$version.tar.xz"
checksum="961b23ca1acfd28f2bc87414c27bb40e12436efcf2158d29721b1e89f3f28057"
conf_files="/etc/pulse/*"
build_style="gnu-configure"
configure_args+=" --disable-asyncns"
configure_args+=" --disable-avahi"
configure_args+=" --disable-bluez4"
configure_args+=" --disable-bluez5"
configure_args+=" --disable-bluez5-native-headset"
configure_args+=" --disable-bluez5-ofono-headset"
configure_args+=" --disable-dbus"
configure_args+=" --disable-esound"
configure_args+=" --disable-gconf"
configure_args+=" --disable-glib2"
configure_args+=" --disable-gtk3"
configure_args+=" --disable-hal-compat"
configure_args+=" --disable-jack"
configure_args+=" --disable-lirc"
configure_args+=" --disable-oss-output"
configure_args+=" --disable-oss-wrapper"
configure_args+=" --disable-systemd-daemon"
configure_args+=" --disable-systemd-journal"
configure_args+=" --disable-systemd-login"
configure_args+=" --disable-tcpwrap"
configure_args+=" --disable-webrtc-aec"
configure_args+=" --disable-x11"
configure_args+=" --enable-adrian-aec"
configure_args+=" --enable-alsa"
configure_args+=" --enable-orc"
configure_args+=" --with-bash-completion-dir=/usr/share/bash-completion/completions"
configure_args+=" --with-database=tdb"
configure_args+=" --with-udev-rules-dir=/usr/lib/udev/rules.d"
system_groups="pulse-access"
system_accounts="pulse"
pulse_groups="audio"
pulse_homedir="/var/empty"

case "$XBPS_TARGET_MACHINE" in
  # disable neon optimizations for the arm* architectures
  arm*)
    configure_args+=" --disable-neon-opt"
    ;;
esac

post_install() {
  rm -f "$DESTDIR/etc/dbus-1/system.d/pulseaudio-system.conf"
  vsv pulseaudio
}

libpulseaudio_package() {
  shlib_provides+=" libpulsecommon-$version.so"
  shlib_provides+=" libpulsecore-$version.so"
  short_desc+=" - shared libraries"
  pkg_install() {
    vmove "usr/lib/libpulse.so.*"
    vmove "usr/lib/libpulse-simple.so.*"
    vmove usr/lib/pulseaudio
  }
}

pulseaudio-devel_package() {
  depends="libpulseaudio>=${version}_$revision"
  short_desc+=" - development files"
  pkg_install() {
    vmove usr/include
    vmove usr/lib/pkgconfig
    vmove usr/lib/cmake
    vmove usr/lib/libpulse.so
    vmove usr/lib/libpulse-simple.so
    vmove usr/share/vala
  }
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
