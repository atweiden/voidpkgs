maintainer="nox"
pkgname="cmake"
version=3.19.0
revision=1
short_desc="Cross-platform, open-source build system"
makedepends+=" expat-devel"
makedepends+=" libarchive-devel"
makedepends+=" libcurl-devel"
makedepends+=" libuv-devel"
makedepends+=" ncurses-devel"
makedepends+=" rhash-devel"
checkdepends+=" pax"
checkdepends+=" pkg-config"
hostmakedepends+=" cmake-bootstrap"
hostmakedepends+=" gcc-fortran"
homepage="https://www.cmake.org"
license="LGPL-2.1-or-later, BSD-3-Clause"
distfiles="https://www.cmake.org/files/v${version%.*}/$pkgname-$version.tar.gz"
checksum="fdda688155aa7e72b7c63ef6f559fca4b6c07382ea6dca0beb5f45aececaf493"
build_style="cmake"
configure_args+=" -DCMAKE_BUILD_TYPE=None"
configure_args+=" -DCMAKE_DOC_DIR=/share/doc/cmake"
configure_args+=" -DCMAKE_USE_SYSTEM_BZIP2=1"
configure_args+=" -DCMAKE_USE_SYSTEM_CURL=1"
configure_args+=" -DCMAKE_USE_SYSTEM_EXPAT=1"
configure_args+=" -DCMAKE_USE_SYSTEM_LIBARCHIVE=1"
configure_args+=" -DCMAKE_USE_SYSTEM_LIBLZMA=1"
configure_args+=" -DCMAKE_USE_SYSTEM_LIBRHASH=1"
configure_args+=" -DCMAKE_USE_SYSTEM_LIBUV=1"
configure_args+=" -DCMAKE_USE_SYSTEM_ZLIB=1"
configure_args+=" -DKWSYS_LFS_WORKS=1"
make_check_target="test"

pre_check() {
  # use ctest of this build instead of requiring cmake to test cmake...
  vsed \
    -i \
    -e 's!/usr/bin/ctest!ctest!g' \
    "$wrksrc/build/Makefile"
  export PATH="$wrksrc/build/bin:$PATH"
}

post_install() {
  vlicense Copyright.txt
  vlicense Utilities/KWIML/Copyright.txt KWIML-Copyright.txt
  vlicense Utilities/cmzlib/Copyright.txt cmzlib-Copyright.txt
  rm -rf "$DESTDIR/usr/share/doc/cmake"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
