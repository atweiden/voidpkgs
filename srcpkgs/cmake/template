maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="cmake"
version=3.14.5
revision=1
short_desc="Cross-platform, open-source build system"
makedepends+=" expat-devel"
makedepends+=" libarchive-devel"
makedepends+=" libcurl-devel"
makedepends+=" libuv-devel"
makedepends+=" ncurses-devel"
makedepends+=" rhash-devel"
homepage="https://www.cmake.org"
license="LGPL-2.1-or-later, BSD-3-Clause"
distfiles="https://www.cmake.org/files/v${version%.*}/$pkgname-$version.tar.gz"
checksum="505ae49ebe3c63c595fa5f814975d8b72848447ee13b6613b0f8b96ebda18c06"
build_style="configure"
make_check_target="test"

if [[ -n "$CROSS_BUILD" ]]; then
  # XXX ugly :-)
  build_style="cmake"
  hostmakedepends+=" cmake"
  hostmakedepends+=" gcc-fortran"
  configure_args+=" -DCMAKE_DOC_DIR=/share/doc/cmake"
  configure_args+=" -DCMAKE_USE_SYSTEM_BZIP2=1"
  configure_args+=" -DCMAKE_USE_SYSTEM_CURL=1"
  configure_args+=" -DCMAKE_USE_SYSTEM_EXPAT=1"
  configure_args+=" -DCMAKE_USE_SYSTEM_LIBARCHIVE=1"
  configure_args+=" -DCMAKE_USE_SYSTEM_LIBLZMA=1"
  configure_args+=" -DCMAKE_USE_SYSTEM_ZLIB=1"
  configure_args+=" -DKWSYS_LFS_WORKS=1"
else
  build_style="configure"
  configure_args+=" --prefix=/usr"
  configure_args+=" --mandir=/share/man"
  configure_args+=" --docdir=/share/doc/cmake"
  configure_args+=" --system-libs"
  configure_args+=" --no-system-jsoncpp"
  configure_args+=" ${XBPS_MAKEJOBS:+--parallel=$XBPS_MAKEJOBS}"
fi

post_install() {
  vlicense Copyright.txt
  vlicense Utilities/cmzlib/Copyright.txt cmzlib-Copyright.txt
  vlicense Utilities/cmcompress/Copyright.txt cmcompress-Copyright.txt
  rm -rf "$DESTDIR/usr/share/doc/cmake"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
