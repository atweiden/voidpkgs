maintainer="nox"
pkgname="i2pd"
version=2.44.0
revision=3
short_desc="Full-featured C++ implementation of I2P client"
makedepends+=" boost-devel"
makedepends+=" libatomic-devel"
makedepends+=" miniupnpc-devel"
makedepends+=" openssl-devel"
makedepends+=" zlib-devel"
homepage="https://i2pd.website/"
license="BSD-3-Clause"
changelog="https://github.com/PurpleI2P/i2pd/raw/openssl/ChangeLog"
distfiles="https://github.com/PurpleI2P/i2pd/archive/$version.tar.gz>$pkgname-$version.tar.gz"
checksum="b653c845ac7a16fefab2ace78e3ae496c12b05304bb66e41e776071635d4e070"
conf_files+=" /etc/i2pd/i2pd.conf"
conf_files+=" /etc/i2pd/tunnels.conf"
build_style="gnu-makefile"
make_build_args+=" USE_UPNP=yes"
case "$XBPS_TARGET_MACHINE" in
  x86_64*)
    ;;
  *)
    make_build_args="USE_AESNI=no"
    ;;
esac
system_accounts="_i2pd"
_i2pd_homedir="/var/lib/i2pd"
make_dirs="/var/lib/i2pd 0700 _i2pd _i2pd"

do_install() {
  vbin i2pd
  vlicense LICENSE
  vman debian/i2pd.1
  vinstall contrib/i2pd.conf 644 etc/i2pd
  vinstall contrib/tunnels.conf 644 etc/i2pd
}

post_install() {
  vsv i2pd
  # family, reseed and router certificates
  vmkdir usr/share/i2pd
  vcopy contrib/certificates usr/share/i2pd
  vmkdir var/lib/i2pd
  ln -s /usr/share/i2pd/certificates "$DESTDIR/var/lib/i2pd/certificates"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
