# Template file for 'electrum-git'
maintainer="Andy Weidenbaum <archbaum@gmail.com>"
pkgname="electrum-git"
version=20180814
revision=1
short_desc="Lightweight Bitcoin wallet"
noarch="yes"
depends+=" libsecp256k1-devel"                              # [CHECK]
depends+=" python3"                                         # [CHECK]
depends+=" python3-dnspython"                               # [CHECK]
depends+=" python3-ecdsa"                                   # [CHECK]
depends+=" python3-jsonrpclib-pelix"                        # [CHECK]
depends+=" python3-protobuf"                                # [CHECK]
depends+=" python3-pyaes"                                   # [CHECK]
depends+=" python3-pycryptodomex"                           # [CHECK]
depends+=" python3-pysocks"                                 # [CHECK]
depends+=" python3-qrcode"                                  # [CHECK]
depends+=" python3-requests"                                # [CHECK]
depends+=" $(vopt_if hw python3-btchip)"                    # [MISSING]
depends+=" $(vopt_if hw python3-hidapi)"                    # [MISSING]
depends+=" $(vopt_if hw python3-keepkey)"                   # [MISSING]
depends+=" $(vopt_if hw python3-safet)"                     # [MISSING]
depends+=" $(vopt_if hw python3-six)"                       # [CHECK]
depends+=" $(vopt_if hw python3-trezor)"                    # [MISSING]
depends+=" $(vopt_if hw python3-websocket-client)"          # [CHECK]
depends+=" $(vopt_if qt hicolor-icon-theme)"                # [CHECK]
depends+=" $(vopt_if qt python3-PyQt5)"                     # [CHECK]
depends+=" $(vopt_if qt python3-QDarkStyle)"                # [CHECK]
depends+=" $(vopt_if qt xdg-utils)"                         # [CHECK]
depends+=" $(vopt_if qt zbar)"                              # [CHECK]
#checkdepends="python3-tox"                                 # [MISSING]
hostmakedepends+=" gettext"                                 # [CHECK]
hostmakedepends+=" git"                                     # [CHECK]
hostmakedepends+=" protobuf"                                # [CHECK]
hostmakedepends+=" python3-curl"                            # [CHECK]
hostmakedepends+=" python3-requests"                        # [CHECK]
hostmakedepends+=" python3-setuptools"                      # [CHECK]
hostmakedepends+=" $(vopt_if qt python3-PyQt5-devel-tools)" # [CHECK]
homepage="https://github.com/spesmilo/electrum"
license="MIT"
changelog="https://raw.githubusercontent.com/spesmilo/electrum/master/RELEASE-NOTES"
wrksrc="${pkgver^}-$version"
build_options+=" hw"
build_options+=" qt"
desc_option_hw="Enable support for hardware wallets"
desc_option_qt="Enable support for QT desktop GUI"
build_options_default+=" hw"
build_options_default+=" qt"
build_style="python3-module"
pycompile_module+=" electrum"
pycompile_module+=" electrum_plugins"
pycompile_module+=" $(vopt_if qt electrum_gui)"
provides="electrum"
conflicts="electrum"

do_fetch() {
	git clone "$homepage" "$wrksrc"
}

pre_build() {
	# compile icons for qt
	eval "$(vopt_if qt 'pyrcc5 icons.qrc -o electrum/gui/qt/icons_rc.py' 'echo')"

	# compile protobuf description file
	protoc \
		--proto_path=electrum \
		--python_out=electrum \
		electrum/paymentrequest.proto

	# create translations
	python3 contrib/make_locale
}

do_check() {
	_pyver="$(python3 -c \
		'import platform; print("%s%s" % platform.python_version_tuple()[0:2])')"
	tox -e "py$_pyver"
}

post_install() {
	vlicense "$GOSRCPATH/LICENCE"
	vdoc "$GOSRCPATH/AUTHORS"
	vdoc "$GOSRCPATH/RELEASE-NOTES"
	vdoc "$GOSRCPATH/README.rst"
}

# vim: set filetype=sh foldmethod=marker foldlevel=0 nowrap:
